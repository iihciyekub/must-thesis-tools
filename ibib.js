const strokes = "乙丁九刁刀力乜于士才寸大上山千及夕之己弓子王亓井天夫元五支不太友尤巨戈止少中水牛毛壬仁仇仉化仍戶户介公丹勾殳卞六文亢方尹孔巴以允毋玉示邗巧邛功甘世艾古本可丙左石布戊平北占甲申田由史冉生禾丘代仙白他瓜仝令用印卯包市玄永司弘出召皮台母匡刑邢戎圭吉考老芒西在有百成夷光曲同回年朱竹休伍伏延仲仵任仰伊向似行全合兆夙危多次衣亥充羊米汗江汲池汝宇守字安祁那阮羽牟扶抄赤折孝抗却芮花杜巫杞李求孛車车甫束吾豆邴夾夹邶步肖貝贝呂吕別别吳吴岑告利邱何但伯佟位佛佘希邸狂狄彤系言况冷辛汪沐沙沃沈忻完宋宏牢良初罕尾局改阿陀姒邵邰奉武青表長长拓幸招其苦昔茂苗英苟茆苑茅林枝枚析板來来松杭東东奈奇叔歧卓虎尚果昌門门明易昂典呼帖迮牧和季委竺侍岳佴佼依帛卑所金受念瓮朋肥周咎京冼府庚於卷法泣泥波性宗定宜官空宛宓郎房祈建居屈承孟函姓始春封拱城郝荊荆革荀胡茹南柯查相柏柳厙厍威厚郟郏是冒星哈拜郜香秋段修保信皇泉禹侯帥帅俟律後后俞郗俎風风逄昝計计哀度奕施前首洪洛洋宣宦冠軍军祖祝弭韋韦胥姚飛飞盈羿勇柔紅红紀纪泰秦班敖素馬马貢贡袁都盍耿華华恭莫仓倉莘晋真莊庄桂桓桐校索軒轩連连速栗夏原柴時时畢毕閃闪晁晏員员剛刚乘秘候倪倫伦隽皋烏乌師师徐殷針针釗钊奚翁卿逢留衷高郭席庫库唐旁旅益烟郯浦酒海浮悟家宮宫容宰書书展陸陆陳陈孫孙陰阴陶姬通能務务桑納纳理堵捷焉赧接聊萇苌萊莱菅乾梅麥麦曹區区堅坚戚盛雪雀堂常眭野閆闫閉闭問问婁娄鄂國国崔崇過过犁笪符第敏偶進进偉伟從从悉脫脱魚鱼象斛祭訥讷許许庹麻庾康鹿章商望牽牵粘清淩凌渠淦淳淡梁寇宿扈逮逯尉屠張张隋將将陽阳隗隆習习貫贯終终紹绍巢貳贰琴琦堯尧塔項项越賁贲揚扬揭喜彭達达斯黃黄葉叶萬万葛董敬葷荤辜植森棟栋惠覃粟雲云斐紫掌戢開开閎闳閔闵遇景貴贵單单喻買买無无智嵇程稅税喬乔答傅集焦鄔邬須须舒鈔钞欽钦鈄钭鈕钮禽舜猶犹貿贸鄒邹馮冯童善普道曾勞劳湛湯汤滑游渾浑惲恽寒富運运祿禄尋寻强費费疏賀贺登瑞載载鄢勢势聖圣蓋盖鄞勤靳蒼苍蒯蓬蒿蒲蒙幹干楚楊杨裘甄賈贾雷零頓顿督訾虞業业睦睢愚路農农節节微徭愈愛爱貊詹解詩诗廉資资裔靖雍義义慈溥源溫温塗涂慎塞褚福辟經经碧趙赵嘉赫壽寿綦慕蔔卜蔡蔚蔣蒋厲厉碩硕爾尔臧裴暢畅聞闻閩闽閭闾鄲郸圖图種种稱称箕管毓僕仆僑侨僧僪銀银鳳凤說说廣广麽么廖竭韶端齊齐旗養养鄭郑榮荣漢汉滿满漆漫賓宾寧宁實实肇禚暨隨随翟翠熊鄧邓緒绪綫线撒駒驹鞏巩穀谷蕢蒉樓楼樊歐欧劇剧輝辉賞赏暴墨稽黎範范儀仪樂乐德衛卫盤盘銳锐劍剑虢餘余滕魯鲁劉刘諸诸諾诺談谈摩褒慶庆翦潜潮潭潘澄遲迟嬀妫練练緱缑駱骆操薑姜燕薛薊蓟薄蕭萧薩萨樹树樸朴橋桥機机賴赖融醜丑勵励曆历霍冀頻频盧卢閻阎蹉戰战穆篤笃興兴學学衡錯错錢钱鮑鲍獨独諶谌諫谏憑凭鄺邝磨龍龙嬴營营澹隱隐璩環环戴聲声鞠藍蓝藏韓韩檢检檀霜戲戏矯矫魏繁儲储禦御鍾锺斂敛鮮鲜謝谢糜應应齋斋濮濯賽赛蹇謇禮礼彌弥縱纵繆缪騎骑聶聂藤藩豐丰叢丛瞿闕阙曠旷顓颛簡简雙双邊边歸归鎮镇鎖锁謬谬顔颜額额禰祢藺蔺蘇苏麴闞阚關关蟻蚁嚴严羅罗鏡镜譚谭譙谯龐庞類类瀧泷懷怀繩绳壤蘭兰酆鹹咸黨党籍鐘钟釋释饒饶騰腾寶宝竇窦權权酈郦鐵铁鐸铎夔顧顾續续穰龔龚襲袭欒栾讓让蠻蛮釁衅鬱郁abcdefghijklmnopqrstuvwxyz";

const strokes_py = [
    "yi", "ding", "jiu", "diao", "dao", "li", "nie", "yu", "shi", "cai", "cun", "da", "shang", "shan", "qian", "ji", "xi", "zhi", "ji", "gong", "zi", "wang", "qi", "jing", "tian", "fu", "yuan", "wu", "zhi", "bu", "tai", "you", "you", "ju", "ge", "zhi", "shao", "zhong", "shui", "niu", "mao", "ren", "ren", "chou", "zhang", "hua", "reng", "hu", "hu", "jie", "gong", "dan", "gou", "shu", "bian", "liu", "wen", "kang", "fang", "yin", "kong", "ba", "yi", "yun", "wu", "yu", "shi", "han", "qiao", "qiong", "gong", "gan", "shi", "ai", "gu", "ben", "ke", "bing", "zuo", "shi", "bu", "wu", "ping", "bei", "zhan", "jia", "shen", "tian", "you", "shi", "ran", "sheng", "he", "qiu", "dai", "xian", "bai", "ta", "gua", "tong", "ling", "yong", "yin", "mao", "bao", "shi", "xuan", "yong", "si", "hong", "chu", "zhao", "pi", "tai", "mu", "kuang", "xing", "xing", "rong", "gui", "ji", "kao", "lao", "mang", "xi", "zai", "you", "bai", "cheng", "yi", "guang", "qu", "tong", "hui", "nian", "zhu", "zhu", "xiu", "wu", "fu", "yan", "zhong", "wu", "ren", "yang", "yi", "xiang", "si", "hang", "quan", "he", "zhao", "su", "wei", "duo", "ci", "yi", "hai", "chong", "yang", "mi", "han", "jiang", "ji", "chi", "ru", "yu", "shou", "zi", "an", "qi", "na", "ruan", "yu", "mou", "fu", "chao", "chi", "she", "xiao", "kang", "que", "rui", "hua", "du", "wu", "qi", "li", "qiu", "bo", "che", "che", "fu", "shu", "wu", "dou", "bing", "ga", "jia", "bei", "bu", "xiao", "bei", "bei", "lu", "lu", "bie", "bie", "wu", "wu", "cen", "gao", "li", "qiu", "he", "dan", "bo", "tong", "wei", "fo", "she", "xi", "di", "kuang", "di", "tong", "xi", "yan", "kuang", "leng", "xin", "wang", "mu", "sha", "wo", "shen", "xin", "wan", "song", "hong", "lao", "liang", "chu", "han", "wei", "ju", "gai", "a", "tuo", "si", "shao", "tai", "feng", "wu", "qing", "biao", "zhang", "zhang", "tuo", "xing", "zhao", "qi", "ku", "xi", "mao", "miao", "ying", "gou", "mao", "yuan", "mao", "lin", "zhi", "mei", "xi", "ban", "lai", "lai", "song", "hang", "dong", "dong", "nai", "qi", "shu", "qi", "zhuo", "hu", "shang", "guo", "chang", "men", "men", "ming", "yi", "ang", "dian", "hu", "tie", "ze", "mu", "he", "ji", "wei", "zhu", "shi", "yue", "er", "jiao", "yi", "bo", "bei", "suo", "jin", "shou", "nian", "weng", "peng", "fei", "zhou", "jiu", "jing", "xian", "fu", "geng", "yu", "juan", "fa", "qi", "ni", "bo", "xing", "zong", "ding", "yi", "guan", "kong", "wan", "mi", "lang", "fang", "qi", "jian", "ju", "qu", "cheng", "meng", "han", "xing", "shi", "chun", "feng", "gong", "cheng", "hao", "jing", "jing", "ge", "xun", "hu", "ru", "nan", "ke", "cha", "xiang", "bai", "liu", "she", "she", "wei", "hou", "jia", "jia", "shi", "mao", "xing", "ha", "bai", "gao", "xiang", "qiu", "duan", "xiu", "bao", "xin", "huang", "quan", "yu", "hou", "shuai", "shuai", "si", "lu", "hou", "hou", "yu", "xi", "zu", "feng", "feng", "pang", "zan", "ji", "ji", "ai", "du", "yi", "shi", "qian", "shou", "hong", "luo", "yang", "xuan", "huan", "guan", "jun1", "jun1", "zu", "zhu", "mi", "wei", "wei", "xu", "yao", "fei", "fei", "ying", "yi", "yong", "rou", "hong", "hong", "ji", "ji", "tai", "qin", "ban", "ao", "su", "ma", "ma", "gong", "gong", "yuan", "dou", "he", "geng", "hua", "hua", "gong", "mo", "cang", "cang", "shen", "jin", "zhen", "zhuang", "zhuang", "gui", "huan", "tong", "xiao", "suo", "xuan", "xuan", "lian", "lian", "su", "li", "xia", "yuan", "chai", "shi", "shi", "bi", "bi", "shan", "shan", "chao", "yan", "yuan", "yuan", "gang", "gang", "cheng", "mi", "hou", "ni", "lun", "lun", "jun4", "gao", "wu", "wu", "shi", "shi", "xu", "yin", "zhen", "zhen", "zhao", "zhao", "xi", "weng", "qing", "feng", "liu", "zhong", "gao", "guo", "xi", "ku", "ku", "tang", "pang", "lu", "yi", "yan", "tan", "pu", "jiu", "hai", "fu", "wu", "jia", "gong", "gong", "rong", "zai", "shu", "shu", "zhan", "lu", "lu", "chen", "chen", "sun", "sun", "yin", "yin", "tao", "ji", "tong", "neng", "wu", "wu", "sang", "na", "na", "li", "du", "jie", "yan", "nan", "jie", "liao", "chang", "chang", "lai", "lai", "jian", "qian", "mei", "mai", "mai", "cao", "qu", "qu", "jian", "jian", "qi", "sheng", "xue", "que", "tang", "chang", "sui", "ye", "yan", "yan", "bi", "bi", "wen", "wen", "lou", "lou", "e", "guo", "guo", "cui", "chong", "guo", "guo", "li", "da", "fu", "di", "min", "ou", "jin", "jin", "wei", "wei", "cong", "cong", "xi", "tuo", "tuo", "yu", "yu", "xiang", "hu", "ji", "ne", "ne", "xu", "xu", "tuo", "ma", "yu", "kang", "lu", "zhang", "shang", "wang", "qian", "qian", "zhan", "qing", "ling", "ling", "qu", "gan", "chun", "dan", "liang", "kou", "xiu", "hu", "dai", "lu", "wei", "tu", "zhang", "zhang", "sui", "jiang", "jiang", "yang", "yang", "wei", "long", "xi", "xi", "guan", "guan", "zhong", "zhong", "shao", "shao", "chao", "er", "er", "qin", "qi", "yao", "yao", "ta", "xiang", "xiang", "yue", "ben", "ben", "yang", "yang", "jie", "xi", "peng", "da", "da", "si", "huang", "huang", "ye", "ye", "wan", "wan", "ge", "dong", "jing", "hun", "hun", "gu", "zhi", "sen", "dong", "dong", "hui", "tan", "su", "yun", "yun", "fei", "zi", "zhang", "ji", "kai", "kai", "hong", "hong", "min", "min", "yu", "jing", "gui", "gui", "dan", "dan", "yu", "mai", "mai", "wu", "wu", "zhi", "ji", "cheng", "shui", "shui", "qiao", "qiao", "da", "fu", "ji", "jiao", "wu", "wu", "xu", "xu", "shu", "chao", "chao", "qin", "qin", "dou", "tou", "niu", "niu", "qin", "shun", "you", "you", "mao", "mao", "zou", "zou", "feng", "feng", "tong", "shan", "pu", "dao", "ceng", "lao", "lao", "zhan", "tang", "tang", "hua", "you", "hun", "hun", "yun", "yun", "han", "fu", "yun", "yun", "lu", "lu", "xun", "xun", "qiang", "fei", "fei", "shu", "he", "he", "deng", "rui", "zai", "zai", "yan", "shi", "shi", "sheng", "sheng", "gai", "gai", "yin", "qin", "jin", "cang", "cang", "kuai", "peng", "hao", "pu", "meng", "gan", "gan", "chu", "yang", "yang", "qiu", "zhen", "jia", "jia", "lei", "ling", "dun", "dun", "du", "zi", "yu", "ye", "ye", "mu", "sui", "yu", "lu", "nong", "nong", "jie", "jie", "wei", "yao", "yu", "ai", "ai", "mo", "zhan", "jie", "shi", "shi", "lian", "zi", "zi", "yi", "jing", "yong", "yi", "yi", "ci", "pu", "yuan", "wen", "wen", "tu", "tu", "shen", "sai", "chu", "fu", "pi", "jing", "jing", "bi", "zhao", "zhao", "jia", "he", "shou", "shou", "qi", "mu", "bo", "bo", "cai", "wei", "jiang", "jiang", "li", "li", "shuo", "shuo", "er", "er", "zang", "pei", "chang", "chang", "wen", "wen", "min", "min", "lu", "lu", "dan", "dan", "tu", "tu", "zhong", "zhong", "cheng", "cheng", "ji", "guan", "yu", "pu", "pu", "qiao", "qiao", "seng", "yu", "yin", "yin", "feng", "feng", "shuo", "shuo", "guang", "guang", "me", "me", "liao", "jie", "shao", "duan", "qi", "qi", "qi", "yang", "yang", "zheng", "zheng", "rong", "rong", "han", "han", "man", "man", "qi", "man", "bin", "bin", "ning", "ning", "shi", "shi", "zhao", "zhuo", "ji", "sui", "sui", "zhai", "cui", "xiong", "deng", "deng", "xu", "xu", "xian", "xian", "sa", "ju", "ju", "gong", "gong", "yu", "gu", "kuai", "kui", "lou", "lou", "fan", "ou", "ou", "ju", "ju", "hui", "hui", "shang", "shang", "bao", "mo", "ji", "li", "fan", "fan", "yi", "yi", "le", "le", "de", "wei", "wei", "pan", "pan", "rui", "rui", "jian", "jian", "guo", "yu", "yu", "teng", "lu", "lu", "liu", "liu", "zhu", "zhu", "nuo", "nuo", "tan", "tan", "mo", "bao", "qing", "qing", "jian", "qian", "chao", "tan", "pan", "cheng", "chi", "chi", "gui", "gui", "lian", "lian", "gou", "gou", "luo", "luo", "cao", "jiang", "jiang", "yan", "xue", "ji", "ji", "bao", "xiao", "xiao", "sa", "sa", "shu", "shu", "pu", "pu", "qiao", "qiao", "ji", "ji", "lai", "lai", "rong", "chou", "chou", "li", "li", "li", "li", "huo", "ji", "pin", "pin", "lu", "lu", "yan", "yan", "cuo", "zhan", "zhan", "mu", "du", "du", "xing", "xing", "xue", "xue", "heng", "cuo", "cuo", "qian", "qian", "bao", "bao", "du", "du", "chen", "chen", "jian", "jian", "ping", "ping", "kuang", "kuang", "mo", "long", "long", "ying", "ying", "ying", "dan", "yin", "yin", "qu", "huan", "huan", "dai", "sheng", "sheng", "ju", "lan", "lan", "cang", "han", "han", "jian", "jian", "tan", "shuang", "xi", "xi", "jiao", "jiao", "wei", "fan", "chu", "chu", "yu", "yu", "zhong", "zhong", "lian", "lian", "xian", "xian", "xie", "xie", "mi", "ying", "ying", "zhai", "zhai", "pu", "zhuo", "sai", "sai", "jian", "jian", "li", "li", "mi", "mi", "zong", "zong", "miu", "miu", "qi", "qi", "nie", "nie", "teng", "fan", "feng", "feng", "cong", "cong", "qu", "que", "que", "kuang", "kuang", "zhuan", "zhuan", "jian", "jian", "shuang", "shuang", "bian", "bian", "gui", "gui", "zhen", "zhen", "suo", "suo", "miu", "miu", "ya", "yan", "e", "e", "mi", "mi", "lin", "lin", "su", "su", "qu", "kan", "kan", "guan", "guan", "yi", "yi", "yan", "yan", "luo", "luo", "jing", "jing", "tan", "tan", "qiao", "qiao", "pang", "pang", "lei", "lei", "long", "long", "huai", "huai", "sheng", "sheng", "rang", "lan", "lan", "feng", "jian", "xian", "dang", "dang", "ji", "zhong", "zhong", "shi", "shi", "rao", "rao", "teng", "teng", "bao", "bao", "dou", "dou", "quan", "quan", "li", "li", "tie", "tie", "duo", "duo", "kui", "gu", "gu", "xu", "xu", "rang", "gong", "gong", "xi", "xi", "luan", "luan", "rang", "rang", "man", "man", "xin", "xin", "yu", "yu"
]

const FIELDS = {
    "title": "论文名称",
    "author": "作者名单",
    "journal": "文章发表的期刊或杂志名称",
    "booktitle": "书名，论文集的名称或会议名称",
    "month": "作品出版的月份",
    "year": "出版的年份",
    "volume": "卷号",
    "number": "报告号或期刊文章的刊号",
    "pages": "文章所在书籍或论文集中的页码或页范围",
    "address": "出版商地址或会议举办的地址",
    "organization": "组织或赞助会议或出版手册的机构名称，如 IEEE/ACM/Springer",
    "annote": "注释",
    "chapter": "书中的章节编号",
    "edition": "书的版本号",
    "editor": "书或者论文集的编辑名单",
    "howpublished": "特别出版物的出版通知",
    "institution": "发表及/或赞助报告的机构名称",
    "note": "关于参考文献的说明",
    "publisher": "出版社",
    "school": "大学或学位授予机构名称",
    "series": '书籍或论文集的系列名称',
    "type": "技术报告或论文的类型",
    "url": "网址",
    'isbn': 'ISBN',
    'issn': 'ISSN',
    "date": "日期",
    "doi": "",

}

const ENTRY = {
    "article": "any article published in a periodical like a journal article or magazine article",
    "book": "a book",
    "booklet": "like a book but without a designated publisher",
    "conference": "a conference paper",
    "inbook": "a section or chapter in a book",
    "incollection": "an article in a collection",
    "inproceedings": "a conference paper (same as the conference entry type)",
    "manual": "a technical manual",
    "misc": "used if nothing else fits",
    "phdthesis": "a PhD thesis",
    "mastersthesis": "a Masters thesis",
    "proceedings": "the whole conference proceedings",
    "techreport": "a technical report, government report or white paper",
    "unpublished": "a work that has not yet been officially published",
}

const BIB = {
    'article': {
        'N': ['author', 'year', 'title', 'journal'],
        'UN': ['volume', 'number', 'pages', 'month', 'doi', 'note'],
        'UQ': []
    },
    'conference': {
        'N': ['author', 'year', 'title', 'booktitle'],
        'UN': ['editor', 'volume', 'number', 'series', 'pages', 'address', 'month', 'organization', 'publisher', 'note'],
        'UQ': ['volume/number']
    },
    'inproceedings': {
        'N': ['author', 'year', 'title', 'booktitle'],
        'UN': ['editor', 'volume', 'number', 'series', 'pages', 'address', 'month', 'organization', 'publisher', 'note'],
        'UQ': ['volume/number']
    },
    'proceedings': {
        'N': ['title', 'year', 'editor'],
        'UN': ['volume', 'number', 'series', 'address', 'month', 'organization', 'publisher', 'note'],
        'UQ': ['volume/number']
    },
    'book': {
        'N': ['author', 'title', 'publisher', 'year'],
        'UN': ['volume', 'number', 'series', 'address', 'edition', 'month', 'note'],
        'UQ': ['volume/number']
    },
    'booklet': {
        'N': ['title'],
        'UN': ['author', 'howpublished', 'address', 'month', 'year', 'note'],
        'UQ': []
    },
    'inbook': {
        'N': ['author', 'title', 'chapter', 'pages', 'publisher', 'year'], 'UN': ['volume', 'number', 'series', 'type', 'address', 'edition', 'month', 'note'],
        'UQ': ['volume/number', 'chapter/pages']
    },
    'incollection': {
        'N': ['author', 'title', 'booktitle', 'publisher', 'year'],
        'UN': ['editor', 'volume', 'number', 'series', 'type', 'chapter', 'pages', 'address', 'edition', 'month', 'note'],
        'UQ': ['volume/number']
    },
    'mastersthesis': {
        'N': ['author', 'title', 'school', 'year'],
        'UN': ['type', 'address', 'month', 'note'],
        'UQ': []
    },
    'phdthesis': {
        'N': ['author', 'title', 'year', 'school'],
        'UN': ['address', 'month', 'keywords', 'note'],
        'UQ': []
    },
    'manual': {
        'N': ['title'], 'UN': ['author', 'organization', 'address', 'edition', 'month', 'year', 'note'],
        'UQ': []
    },
    'techreport': {
        'N': ['author', 'title', 'institution', 'year'],
        'UN': ['type', 'number', 'address', 'month', 'note'],
        'UQ': []
    },
    'unpublished': {
        'N': ['author', 'title', 'note'],
        'UN': ['month', 'year'],
        'UQ': []
    },
    'misc': {
        'N': [],
        'UN': ['author', 'title', 'howpublished', 'month', 'year', 'note'],
        'UQ': []
    }
}

class itex {
    constructor(text) {
        this.orgT = text;
        this.T = this.__clear(text);
    };

    __clear(text) {
        text = text.trim()
        let CharList = ['.', '。', '，', ',', '、', '；', ';', '：', ':', '？', '?', '！', '!', '=', '-', '+', '*', '&', '^', '%', '$', '#', '@', '~', '`', '|'];
        // 循环判断 变量 t 的最后一个字符是否在 CharList 中
        while (CharList.indexOf(text.slice(-1)) > -1) {
            text = text.slice(0, -1);
        }

        while (CharList.indexOf(text[0]) > -1) {
            text = text.slice(1,);
        }


        let t = text;
        let r = /[\u4e00-\u9fa5]/g;
        if (r.test(text)) {
            t = t.replace(/([\u4e00-\u9fa5 ，。？！；：“”‘’《》【】（）])\s+([\u4e00-\u9fa5 ，。？！；：“”‘’《》【】（）])/g, "$1$2");
            while (t != text) {
                text = t;
                t = t.replace(/([\u4e00-\u9fa5 ，。？！；：“”‘’《》【】（）])\s+([\u4e00-\u9fa5 ，。？！；：“”‘’《》【】（）])/g, "$1$2");
            }
        }
        return text;
    }



    get T() {
        return this._T;
    }

    set T(text) {
        if (!this.hasOwnProperty("_T")) {
            this._T = ""
        }
        if (!this.hasOwnProperty("_listT")) {
            this._listT = ['']
        }

        let i = this._listT.indexOf(this._T);
        if (i > -1) {
            this._listT[i] = text;
        }
        this._T = text;
    }

    get language() {
        if (!this.hasOwnProperty("_language")) {
            this._language = ''
            if (/^[\u4e00-\u9fa5]/.test(this.T)) {
                this._language = 'zh';
            } else {
                this._language = 'en';
            }
        }
        return this._language
    }

    set language(v) {
        this._language = v;

    }

    _insert(f, b, T = this.T, _listT = this._listT) {
        //遍历 [a,1,] 数组,打印 数组元素的值和下标
        for (let k of f) {
            let i = _listT.indexOf(T);
            if (_listT.indexOf(k) > -1) {
                continue;
            }
            _listT.splice(i, 0, k);
        }
        for (let k of b) {
            let i = _listT.indexOf(T);
            if (_listT.indexOf(k) > -1) {
                continue;
            }
            _listT.splice(i + 1, 0, k);
        }
        return _listT;
    }

    /**
     * 获取最终输出的文本
     */
    get macro() {
        this.T = ` ${this.T}`
        return this._listT.join("");
    }

    get str() {
        return this.T;
    }


    get Title() {
        const commonWords = ["a", "an", "and", "but", "or", "for", "nor", "on", "in", "at", "to", "from", "by", "with", "about", "above", "across", "after", "against", "along", "among", "around", "before", "behind", "below", "beneath", "beside", "between", "beyond", "during", "except", "inside", "into", "like", "near", "of", "off", "out", "over", "past", "since", "through", "throughout", "till", "toward", "under", "until", "up", "upon", "via", "without"];

        let _listT = this._listT;
        let T = this.T;
        let k = _listT.indexOf(T)
        if (k > -1) {
            let i = _listT[k];
            i = i.toLowerCase();
            //将i 按照空格进行分割,如果元素不在 commonwords 数组中,则不进行首字母大写替换
            i = i.replace(/\b(\w+)\b/g, function (m, p1) {
                if (commonWords.indexOf(p1) > -1) {
                    return p1;
                } else {
                    return p1.replace(/(^\s*)(\w)/, function (m, p1, p2) {
                        return p1 + p2.toUpperCase();
                    });
                }
            });
            // update value
            this.T = i;
            this._listT[k] = i;

        }
        return this;
    }

    /**
     * 首字母大写   
     */
    get title() {
        let _listT = this._listT;
        let T = this.T;

        let k = _listT.indexOf(T)
        if (k > -1) {
            let i = _listT[k];
            i = i.toLowerCase();
            // 将i 的第一个单词的首字母进行大写替换 
            i = i.replace(/(^\s*)(\w)/, function (m, p1, p2) {
                return p1 + p2.toUpperCase();
            });
            // update value
            this.T = i;
            this._listT[k] = i;
        }
        return this;
    }

    // /**
    //  * 斜体
    //  */
    get italic() {
        this._listT = this._insert(["{", "\\em"], ["}"]);
        return this;
    }

    /**
     * 粗体
     */
    get bold() {
        this._listT = this._insert(["{", "\\bfseries"], ["}"]);
        return this;
    }

    /**
     * 圆括号
     */
    get cirBrackets() {
        let t = this.T;
        t = (this.language == 'zh') ? `（${t}）` : `(${t})`;
        this.T = t;
        return this;
    }

    /*
     * 方括号
     */
    get squBrackets() {
        let t = this.T;
        t = (this.language == 'zh') ? `〔${t}〕` : `[${t}]`;
        this.T = t;
        return this;
    }

    get clear() {
        //如果变量t中 存在非 \& 的 & 符号,则将其替换为 \&
        let t = this.T;
        t = t.replace(/(?<!\\)&/g, '\\&');
        t = t.replace(/(?<!\\)%/g, '\\%');
        t = t.replace(/(?<!\\)_/g, '\\_');
        this.T = t;
        return this;

    }

    get url() {
        let t = this.T;
        // 使用 正则表达式 在t 中匹配https开头,连续的字符串,空格或换行 结束的字符串 
        if (t.indexOf('\\url') > -1) {
            return this;
        }
        let url = t.split(" ")
        //如果url 元素包含http或https,则将其替换为 \url{网址}
        url = url.map((v) => {
            if (v.indexOf('http://') > -1 || v.indexOf('https://') > -1) {
                return `\\url{${v}}`;
            } else {
                return v;
            }
        })
        // 将url 数组转换为字符串
        t = url.join(" ");
        this.T = t;
        return this;
    }

}

class idate extends itex {
    constructor(text) {
        super(text);
        this.month_dict = {

            "1": 'January',
            "1": 'February',
            "3": 'March',
            "4": 'April',
            "5": 'May',
            "6": 'June',
            "7": 'July',
            "8": 'August',
            "9": 'September',
            "10": 'October',
            "11": 'November',
            "12": 'December'
            //nbrylgptvc
        };

        // 创建月份英文单词的简写字典
        this.month_dict_abbr = {};
        for (let k in this.month_dict) {
            let v = this.month_dict[k];
            this.month_dict_abbr[k] = v.slice(0, 3);
            if (k == 9) {
                this.month_dict_abbr[k] = v.slice(0, 4);
            }
        };
    }

    get date() {
        let dai = this.orgT.trim();
        var year = '';
        var month = '';
        var day = '';
        var endday = '';
        let r = /(?<year>[12]\d{3})/;
        let a = r.exec(dai);
        if (a != null) {
            year = a.groups.year
            dai = dai.replace(year, '');
            r = /(?<month>[jfmasond][aepuco][nbrylgptvc])/i;
            a = r.exec(dai);
            if (a != null) {
                month = a.groups.month;
                dai = dai.replace(month, '');
                month = month.slice(0, 3);
                month = Object.keys(this.month_dict_abbr).find(key => this.month_dict_abbr[key] === month);
            } else {
                r = /(?<month>\d{1,2})/i;
                a = r.exec(dai);
                if (a != null) {
                    month = a.groups.month;
                    dai = dai.replace(month, '');
                }
            }

            r = /(?<day>\d{1,2})/i;
            a = r.exec(dai);
            if (a != null) {
                day = a.groups.day;
                dai = dai.replace(day, '');
            }

            r = /(?<endday>\d{1,2})/i;
            a = r.exec(dai);
            if (a != null) {
                endday = a.groups.endday;
                dai = dai.replace(endday, '');
            }

            if (month > 12) {
                [month, day, endday] = [month, day, endday].sort((a, b) => a - b);
                [day, endday] = [day, endday].sort((a, b) => a - b);
            }
            dai = [year, month, day, endday].filter((v) => v != '').join('-');
        }
        this._year = year;
        this._month = month;
        this._day = day;
        this._endday = endday;

        this.T = dai;
        return this;
    }

    get year() {
        if (!this.hasOwnProperty('_year')) {
            this.date;
        }
        this.T = this._year;
        return this
    }

    get month() {
        if (!this.hasOwnProperty('_year')) {
            this.date;
        }
        this.T = this._month;
        return this

    }

    get month_abbr() {
        if (!this.hasOwnProperty('_month')) {
            this.date;
        }
        let mon = this._month;
        mon = this.month_dict_abbr[mon];
        if (mon == undefined) {
            mon = "";
        }
        this.T = mon;
        return this;
    }

    get month_full() {
        if (!this.hasOwnProperty('_month')) {
            this.date;
        }
        let mon = this._month;
        mon = this.month_dict[mon];
        if (mon == undefined) {
            mon = "";
        }
        this.T = mon;
        return this;
    }

    get day() {
        this.date;
        this.T = this._day;
        return this
    }

    get endday() {
        this.date;
        this.T = this._endday;
        return this
    }

    get date_zh() {
        if (!this.hasOwnProperty('_year')) {
            this.date;
        }
        if (this._year != "") {
            var y = this._year + "年"
        };
        if (this._month != "") {
            var m = this._month + "月"
        };
        if (this._endday != "") {
            var d = this._day
            var ed = this._endday + "日"
            d = d + "~" + ed
        } else if (this._day != "") {
            var d = this._day + "日"
        };
        this.T = [y, m, d].join("");
        return this;
    }

    get date_en_abbr() {
        if (!this.hasOwnProperty('_year')) {
            this.date;
        }

        let y = this._year;
        let m = this.month_abbr.str;
        let d = this._day;
        let ed = this._endday;

        let t1 = [y, m].filter((i) => i != "").join(", ");
        let t2 = [d, ed].filter((i) => i != "").join("-");
        let t = [t1, t2].filter((i) => i != "").join(". ");

        this.T = t;
        return this;
    }

    get date_en_full() {
        if (!this.hasOwnProperty('_year')) {
            this.date;
        }

        let y = this._year;
        let m = this.month_full.str;
        let d = this._day;
        let ed = this._endday;

        let t1 = [y, m].filter((i) => i != "").join(", ");
        let t2 = [d, ed].filter((i) => i != "").join("-");
        let t = [t1, t2].filter((i) => i != "").join(". ");

        this.T = t;

        return this;
    }

}

class iname extends itex {
    constructor(text) {
        super(text);
    }

    get language() {
        if (this.hasOwnProperty("_language")) { return this["_language"]; }

        this._language = ''
        let t = this.T;
        t = t.match(/[\u4e00-\u9fa5]/) ? 'zh' : 'en';
        this["_language"] = t;
        return this["_language"];
    }

    set language(lang) {
        this["_language"] = lang;
    }

    get name() {
        if (this.hasOwnProperty("_name")) { return this["_name"] };
        this._name = 'author'
        return this._name;
    }

    set name(v) {
        this._name = v;
    }

    __to_list() {
        let t_list = this.T;
        let name = this.name;
        let fidld1 = `_${name}_list`
        let fidld2 = `_${name}_num`

        t_list = t_list.split('and').map(x => x.trim()).filter(x => x !== '');
        this[fidld1] = t_list;
        this[fidld2] = t_list.length;
    }

    __cn_name_dict() {
        let name = this.name;
        this.__to_list();

        let t_list = this[`_${name}_list`]
        let t_dic = {};
        t_list.forEach((n, index) => {
            // 如果,符号   在作者名字中
            if (n.includes(",")) {
                //,符号分割 ,去空格去除空元素
                n = n.split(",").map(s => s.trim()).filter(s => s);
                // 将第一个元素保存到 namedict[index]['first'] 中
                t_dic[index] = { 'first': [n[0]] };
                // 删除第一个元素
                n.shift();
                // 将剩余元素保存到 namedict[index]['others'] 中
                t_dic[index]['others'] = n;

            } else {
                n = n.trim().replace(" ", '');
                if (n.length >= 4) {
                    //将前两个字符保存到 namedict[index]['first'] 中
                    t_dic[index] = { 'first': [n.slice(0, 2)] };
                    //将剩余字符保存到 namedict[index]['others'] 中
                    t_dic[index]['others'] = [n.slice(2)];
                } else {
                    //将字符保存到 namedict[index]['first'] 中
                    t_dic[index] = { 'first': [n.slice(0, 1)] };
                    //将剩余字符保存到 namedict[index]['others'] 中
                    t_dic[index]['others'] = [n.slice(1)];
                }
            }
        });
        t_dic = Object.fromEntries(Object.entries(t_dic).sort());
        return t_dic;
    }

    __en_name_dict() {
        let name = this.name;
        this.__to_list();
        let t_list = this[`_${name}_list`]
        let t_dic = {};
        t_list.forEach((n, index) => {
            // 如果,符号   在作者名字中
            if (n.includes(",")) {
                // ,分割 author去空格,去除空元素
                n = n.split(",").map(s => s.trim()).filter(s => s !== "");
                // 将第一个元素保存到 namedict[index]['first'] 中
                t_dic[index] = { 'first': [n[0]] };
                // 删除第一个元素
                n.shift();
            } else {
                // 被空格分割
                n = n.split(" ").map(s => s.trim()).filter(s => s !== "");
                // 将最一个元素保存到 namedict[index]['first'] 中
                t_dic[index] = { 'first': [n[n.length - 1]] };
                // 删除最后一个元素
                n.pop();
            }
            n = n.join(" ");
            n = n.split(" ").map(s => s.trim()).filter(s => s).map(s => s.replace(".", ""));
            t_dic[index]['others'] = n;

        });
        // 更新 t_dic,按key 排序
        t_dic = Object.fromEntries(Object.entries(t_dic).sort());
        return t_dic;
    }

    __to_dict() {
        let name = this.name;
        let field = `_${name}_dict`;
        if (!this.hasOwnProperty(field)) {
            let lan = this.language;
            let v = ''
            if (lan == 'zh') {
                v = this.__cn_name_dict()
            } else if (lan == 'en') {
                v = this.__en_name_dict()
            }
            this[field] = v;
        }
        // return this[field];
    }

    _join_name(t_dic, k) {
        let [a, b] = ['', ''];
        a = t_dic[k]['first'].map(s => s.charAt(0).toUpperCase() + s.slice(1))
        a = a.filter(s => s !== "")
        a = a.join(" ");
        b = t_dic[k]['others'].map(s => s.charAt(0).toUpperCase())
        b = b.filter(s => s !== "")
        b = b.join(".");
        a = [a, b].join("");
        return a;

    }

    /**
     *  apa 格式要求下的,作者 list, 
     */
    get apa_authors() {
        this.name = 'author';
        let name = this.name;
        let apaField = `_${name}_apa7`
        if (this.hasOwnProperty(apaField)) { return this[apaField] };
        this.__to_dict();
        let t_dic = this[`_${name}_dict`];
        if (Object.keys(t_dic).length == 0) { return "" };


        let lan = this.language;
        let num_name = this[`_${name}_num`]

        let v = "";
        let a = "";
        let apa_sty_name = [];

        if (lan == 'en') {
            for (let key in t_dic) {
                if (key == 0) {
                    a = this._join_name(t_dic, key)
                    apa_sty_name.push(a);
                };
                if (key >= 1 && key <= 19 && key < num_name - 1) {
                    a = this._join_name(t_dic, key)
                    apa_sty_name.push(a);
                };
                if (key != 0 && key == num_name - 1) {
                    a = this._join_name(t_dic, key)
                    apa_sty_name.push(`\\& ${a}`);
                };
                if (key == 20 && num_name >= 21) {
                    apa_sty_name.push(`,...`);
                };
            }
            v = apa_sty_name.join(", ");
        } else if (lan == 'zh') {
            for (let key in t_dic) {
                if (key == 0) {
                    a = t_dic[0]['first'].join("");
                    a += t_dic[0]['others'].join("");
                    apa_sty_name.push(a);
                };
                if (key >= 1 && key <= 19 && key < num_name - 1) {
                    //当key 大于20时
                    a = t_dic[key]['first'].join("");
                    a += t_dic[key]['others'].join("");
                    apa_sty_name.push(a);
                };
                if (key != 0 && key == num_name - 1) {
                    a = t_dic[num_name - 1]['first'].join("");
                    a += t_dic[num_name - 1]['others'].join("");
                    apa_sty_name.push(a);
                };
                if (key == 20 && num_name >= 21) {
                    apa_sty_name.push(`、……`);
                };
            };
            v = apa_sty_name.join("、");
        }
        this[apaField] = v;
        return this[apaField]
    }

    get apa_editors() {
        this.name = 'editor';
        let name = this.name;
        let apaField = `_${name}_apa7`
        if (this.hasOwnProperty(apaField)) { return this[apaField] };
        this.__to_dict();
        let t_dic = this[`_${name}_dict`];
        if (Object.keys(t_dic).length == 0) { return "" };

        let lan = this.language;
        let a = "";

        if (lan == 'en') {
            a = this._join_name(t_dic, 0)
            a = `In ${a} (Ed.)`;
        } else if (lan == 'zh') {
            a = t_dic[0]['first'].join("");
            a += t_dic[0]['others'].join("");
            a = `在${a}（主编）`;
        }
        this[apaField] = a;
        return this[apaField]
    }

    get apa_chair() {
        this.name = 'chairs';
        let name = this.name;
        let apaField = `_${name}_apa7`
        if (this.hasOwnProperty(apaField)) { return this[apaField] };
        this.__to_dict();
        let t_dic = this[`_${name}_dict`];
        if (Object.keys(t_dic).length == 0) { return "" };

        let lan = this.language;
        let a = "";

        if (lan == 'en') {
            a = this._join_name(t_dic, 0)
            a = `In ${a}(Ch.)`;
        } else if (lan == 'zh') {
            a = t_dic[0]['first'].join("");
            a += t_dic[0]['others'].join("");
            a = `在${a}（主持）`;
        }
        this[apaField] = a;
        return this[apaField]
    }

    /**
     * apa 格式要求下的,出现在段落中的作者引用,
     */
    get apa_citeauthor() {
        this.name = 'author';
        let name = this.name;
        let apaField = `_${name}_apa7`
        if (this.hasOwnProperty(apaField)) { return this[apaField] };
        this.__to_dict();
        let t_dic = this[`_${name}_dict`];
        // 判断t_dic 为空字典
        if (Object.keys(t_dic).length == 0) { return "" };

        let lan = this.language;
        let num_name = this[`_${name}_num`]

        let t = "";

        if (lan == 'en') {
            t += t_dic[0]['first'].map(s => s.charAt(0).toUpperCase() + s.slice(1)).join(" ");
            if (num_name == 2) {
                t += ' \\& ';
                t += t_dic[1]['first'].map(s => s.charAt(0).toUpperCase() + s.slice(1)).join(" ");
            } else if (num_name >= 3) {
                t += ' et al.';
            }
        } else if (lan == 'zh') {
            t += t_dic[0]['first'].join("");
            t += t_dic[0]['others'].join("");
            if (num_name == 2) {
                t += '與';
                t += t_dic[1]['first'].join("");
                t += t_dic[1]['others'].join("");
            } else if (num_name >= 3) {
                t += `等`;
            }
        }
        this[apaField] = t;
        return this[apaField]
    }
}

class anybib {
    constructor(txt) {
        this.txt = txt;
        /**
         * 去空行和注释后的原始单个 bib 文本
         */
        this.f_txt = this.__fjoin(txt)

        txt = this.f_txt;
        let entry = this.entryType;
        //如果 entry 不在 ENTRY的key中
        if (!Object.keys(ENTRY).includes(entry)) {
            return ""
        }

        let fileds = BIB[entry]['N'] + BIB[entry]['UN'];

        //遍历 BIB[entry]['N'] 所有的字段，并创建
        BIB[entry]['N'].forEach(f => {
            this[`org_${f}`] = '';
        });

        const key_value = [...txt.matchAll(/(\w+)\s*=\s*[{"'](.*)[}"']/g)].map(m => [m[1], m[2]]);
        key_value.forEach(([field, value]) => {
            field = field.toLowerCase().trim();
            value = value.trim();
            if (fileds.includes(field) && value != '') {
                // 如果field 在 数组[note,authout]中则不需要处理
                if (['note', 'url',].includes(field)) {
                    value = new itex(value);
                    value = value.url.str
                    this[`org_${field}`] = value;
                } else {
                    value = new itex(value);
                    value = value.clear.str;
                    this[`org_${field}`] = value;
                }
            }
        });

    }

    __fjoin(t) {
        t = t.split('\n')
        t = t.filter(line => line.trim() !== '' && !line.trim().startsWith('%'));
        //遍历t 数据, 如果元素去两边空格后, 最后一个字符不是逗号, 则与下一个元素合并

        let b = {};
        let n = 0;
        for (let i = 0; i < t.length; i++) {
            if (!Object.keys(b).includes(n.toString())) {
                b[n] = [t[i]]
            } else {
                b[n].push(t[i])
            }
            if (t[i].trim().endsWith(',')) {
                n += 1
            }
        }
        t = ''
        for (let i = 0; i < Object.keys(b).length; i++) {
            // b[i]元素去左边空格
            b[i] = b[i].map(x => x.trimLeft())
            let c = b[i].join('')
            // 去两边空格
            c = c.trim()
            c += '\n'
            t += c
        }
        return t;

    }

    get_field(field, a = 'apa7', o = 'org') {
        let apaField = `${a}_${field}`;
        let orgField = `${o}_${field}`;

        if (!Object.keys(this).includes(orgField)) { this[orgField] = ''; }
        if (!Object.keys(this).includes(apaField)) { this[apaField] = ''; }

        return [apaField, orgField];
    }

    get entryType() {
        let [apaField, _] = this.get_field('entryType', 'apa7', '');
        if (this[apaField] != '') { return this[apaField] };

        let t = this.f_txt;
        t = t.match(/@(\w*\s*){/)[1];
        t = t.toLowerCase().trim();
        this[apaField] = t;
        return this[apaField];
    }

    get citekey() {
        let [apaField, _] = this.get_field('citekey', 'apa7', '');
        if (this[apaField] != '') { return this[apaField] };

        let t = this.f_txt;
        try {
            t = t.match(/@.*?{(.*?),/)[1];
            t = t.toLowerCase().trim();
        } catch (error) {
            t = '';
        }
        this[apaField] = t;
        return this[apaField];
    }

    set citekey(v) {
        let [apaField, _] = this.get_field('citekey', 'apa7', '');
        this[apaField] = v;
    }

    get author() {
        let [_, orgField] = this.get_field('author');
        return this[orgField];
    }


    get apa_authors() {
        let author = this.author;
        if (author == '') { return "" }
        author = new iname(author);
        return author.apa_authors;
    }

    get apa_citetxt() {
        let [apaField, _] = this.get_field('citetxt', 'apa7', '');
        if (this[apaField] != '') { return this[apaField] };

        let citeauthor = this.author;
        if (citeauthor == '') {
            citeauthor = "null"
        } else {
            citeauthor = new iname(citeauthor);
            citeauthor = citeauthor.apa_citeauthor;
        }
        let year = this.year;
        year = new idate(year);
        year = year.year.str
        if (year == '') { year = this.year }
        let value = [citeauthor, year].join(', ')
        this[apaField] = value;
        return this[apaField];
    }

    /**
     * @parameter {string} v: 会增加到已有apa_citetxt 年份的文本内容后面 (比如, (author 2023) -> (author 2023b))
     */
    apa_citetxt_suffix(v) {
        let [apaField, _] = this.get_field('citetxt', 'apa7', '');
        let vaule = this.apa_citetxt;
        let apayear = vaule.match(/\d{4}/g)[0]
        vaule = vaule.replace(apayear, `${apayear}${v}`)
        this[apaField] = vaule;
    }

    get language() {

        let [apaField, _] = this.get_field('language', 'apa7', '');
        if (this[apaField] != '') { return this[apaField] };
        let t = "";
        if (this.hasOwnProperty("org_author")) {
            t = this.author[0];
        }
        if (t == undefined && this.hasOwnProperty("org_editor")) {
            t = this.editor[0];
        }
        if (t == undefined && this.hasOwnProperty("org_title")) {
            t = this.title[0];
        }
        t = t.match(/[\u4e00-\u9fa5]/) ? 'zh' : 'en';

        this[apaField] = t;
        return this[apaField];
    }

    get apa_title() {
        let [apaField, orgField] = this.get_field('title');
        let title = this[orgField];
        if (this[orgField] == '') { return '' };
        if (this[apaField] != '') { return this[apaField] };

        let language = this.language;
        let entryType = this.entryType;
        let typelist = ['article', 'conference', 'incollection'];

        let value = new itex(title);
        if (language == 'zh') {
            // 如果this.entryType 出现在 lista ['book] 中
            if (!typelist.includes(entryType)) {
                value = value.clear.bold.macro

            } else {
                value = value.clear.str;
            }
        } else if (language == 'en') {
            if (!typelist.includes(entryType)) {
                value = value.clear.title.italic.macro;
            } else {
                value = value.clear.title.str;
            }
        }
        this[apaField] = value;
        return this[apaField]
    }

    get apa_booktitle() {//"书名，论文集的名称或会议名称", 会议论文
        let [apaField, orgField] = this.get_field('booktitle');
        let booktitle = this[orgField];
        if (booktitle == '') { return '' };
        if (this[apaField] != '') { return this[apaField] };

        let language = this.language;
        let entryType = this.entryType;
        let typelist = ['article', 'incollection', 'conference'];
        let value = new itex(booktitle);
        if (language == 'zh') {
            // 如果this.entryType 出现在 lista ['book] 中
            if (typelist.includes(entryType)) {
                value = value.bold.macro
            } else {
                value = value.title.str;
            }
        } else if (language == 'en') {
            if (typelist.includes(entryType)) {
                value = value.title.italic.macro;
            } else {
                value = value.title.str;
            }
        }
        this[apaField] = value;
        return this[apaField]
    }

    get apa_series() {
        let [apaField, orgField] = this.get_field('series');
        let series = this[orgField];
        if (series == '') { return '' };
        if (this[apaField] != '') { return this[apaField] };

        let language = this.language;
        let entryType = this.entryType;
        let typelist = ['book', 'inbook'];
        let value = new itex(series);
        if (language == 'zh') {
            // 如果this.entryType 出现在 lista ['book] 中
            if (typelist.includes(entryType)) {
                value = value.bold.macro
                if (this.apa_volume != '') {
                    value += this.org_volume + "卷";
                }

            } else {
                value = value.title.str;
            }
        } else if (language == 'en') {
            if (typelist.includes(entryType)) {
                value = value.title.italic.macro;
                if (this.apa_volume != '') {
                    value = "volume " + this.org_volume + " of " + value;
                }
            } else {
                value = value.title.str;
            }
        }

        this[apaField] = value;
        return this[apaField];
    }

    get apa_chapter() {//章节编号或标题
        let [apaField, orgField] = this.get_field('chapter');
        let chapter = this[orgField];
        if (chapter == '') { return '' };
        if (this[apaField] != '') { return this[apaField] };

        let language = this.language;
        let entryType = this.entryType;
        let typelist = ['book', 'inbook'];
        let value = new itex(chapter);
        if (language == 'zh') {
            // 如果this.entryType 出现在 lista ['book] 中
            if (typelist.includes(entryType)) {
                value = value.title.str
                value += "章";

            } else {
                value = value.title.str;
            }
        } else if (language == 'en') {
            if (typelist.includes(entryType)) {
                value = "chapter " + value.title.str;
            }
        }

        this[apaField] = value;
        return this[apaField];
    }

    // get apa_date() {
    //     let [_, orgField] = this.get_field('date');
    //     let date = this[orgField];
    //     if (this[orgField] != '') { return this[orgField] };

    //     this[orgField] = date;
    //     return this[orgField]
    // }

    get year() {
        let [_, orgField] = this.get_field('year');
        let year = this[orgField];
        if (this[orgField] != '') {
            //如果没有在year中匹配到4个数字
            if (year.match(/\d{4}/) && year.length == 4) {
                year = new idate(year);
                year = year.year.str;
                this[orgField] = year;
                return this[orgField];
            }
        };

        let language = this.language;
        let value = ''
        // 如果year 和 date 都为空，返回（出版中）
        // 如果year 为空，返回 date
        year = new idate(year);
        value = year.year.str;
        if (value == '') {
            if (language == 'zh') {
                value = `出版中`
            } else if (language == 'en') {
                value = "in press"
            }
        };

        this[orgField] = value
        return this[orgField];
    }

    get apa_year() {
        let [apaField, _] = this.get_field('apayear');
        if (this[apaField] != '') { return this[apaField] };

        let year = this.year;
        let language = this.language;
        let entryType = this.entryType;

        if (!year.match(/\d{4}/)) {
            if (language == 'zh') {
                return `（出版中）`
            } else if (language == 'en') {
                return "(in press)"
            }
        };

        let value = new idate(year);
        value.language = language;
        if (language == 'zh') {
            switch (entryType) {
                case 'misc':
                    value = value.date_zh.cirBrackets.str;
                    break;
                case 'conference':
                    value = value.date_zh.cirBrackets.str;
                    break;
                default:
                    value = value.year.cirBrackets.str;
                    break;
            }
        } else if (language == 'en') {
            switch (entryType) {
                case 'misc':
                    value = value.date_en_full.cirBrackets.str;
                    break;
                case 'conference':
                    value = value.date_en_full.cirBrackets.str;
                    break;
                default:
                    value = value.year.cirBrackets.str;
                    break;
            }
        }
        this[apaField] = value;
        return this[apaField]
    }

    apa_year_suffix(v) {
        let [apaField, _] = this.get_field('apayear');
        // console.log(this.apa_year,'eeeeeeeeeee')
        let vaule = this.apa_year;
        let apayear = vaule.match(/\d{4}/g)[0]
        vaule = vaule.replace(apayear, `${apayear}${v}`)
        this[apaField] = vaule;
    }

    get apa_journal() {
        let [apaField, orgField] = this.get_field('journal');
        let journal = this[orgField];
        if (journal == '') { return '' };
        if (this[apaField] != '') { return this[apaField] };

        let language = this.language;
        let entryType = this.entryType;

        let value = new itex(journal);
        value.language = language;
        if (language == 'zh') {
            switch (entryType) {
                default:
                    value = value.title.bold.macro;
                    break;
            }
        } else if (language == 'en') {
            switch (entryType) {
                default:
                    value = value.Title.italic.macro;
                    break;
            }
        }
        this[apaField] = value;
        return this[apaField]
    }

    get apa_volume() {
        let [apaField, orgField] = this.get_field('volume');
        let volume = this[orgField];
        if (volume == '') { return '' };
        if (this[apaField] != '') { return this[apaField] };


        let language = this.language;
        let entryType = this.entryType;


        let value = new itex(volume);
        value.language = language;

        if (language == 'zh') {
            switch (entryType) {
                default:
                    value = value.italic.bold.macro
                    break;
            }
        } else if (language == 'en') {
            switch (entryType) {
                default:
                    value = value.italic.macro
                    break;
            }
        }
        this[apaField] = value;
        return this[apaField]
    }

    get apa_number() {
        let [apaField, orgField] = this.get_field('number');
        let number = this[orgField];
        if (number == '') { return '' };
        if (this[apaField] != '') { return this[apaField] };

        let language = this.language;
        let entryType = this.entryType;


        let value = new itex(number);
        value.language = language;

        if (language == 'zh') {
            switch (entryType) {
                default:
                    value = value.cirBrackets.str
                    break;
            }
        } else if (language == 'en') {
            switch (entryType) {
                default:
                    value = value.cirBrackets.str
                    break;
            }
        }
        this[apaField] = value;
        return this[apaField]
    }

    get apa_pages() { //页码
        let [apaField, orgField] = this.get_field('pages');
        let pages = this[orgField];
        if (pages == '') { return '' };
        if (this[apaField] != '') { return this[apaField] };

        let language = this.language;
        let entryType = this.entryType;

        let typelist = ['book', 'inbook', 'incollection', 'conference'];
        let value = new itex(pages);

        //  如果pages 包含英文文,则不进行处理\
        if (pages.match(/[\u4e00-\u9fa5]/g) != null || pages.match(/[\u4e00-\u9fa5]/g) != null) {
            // if (pages.match(/[\u4e00-\u9fa5]/g) != null) { 

            // if (pages.match(/\d+/g) == null) {
            value.language = language;
            value = value.squBrackets.str;
        } else {
            if (language == 'zh') {
                // 如果this.entryType 出现在 lista ['book] 中
                if (typelist.includes(entryType)) {
                    value = `（頁 ${value.str}）`
                } else {
                    value = value.str;
                }
            } else if (language == 'en') {
                if (typelist.includes(entryType)) {
                    value = ` (pp.${value.str})`;
                } else {
                    value = value.str;
                }
            }

        }
        this[apaField] = value;
        return this[apaField]
    }

    get apa_doi() {//学术文献 DOI 
        let [apaField, orgField] = this.get_field('doi');
        let doi = this[orgField];
        if (doi == '') { return '' };
        if (this[apaField] != '') { return this[apaField] };

        // 判断 "https://doi.org/" 是否存在 attr 字符中
        if (!doi.includes("https://")) { doi = `https://doi.org/${doi}`; }
        let value = `\\url{${doi}}`;
        this[apaField] = value;
        return this[apaField]
    }

    get apa_publisher() {//出版社
        let [apaField, orgField] = this.get_field('publisher');
        let publisher = this[orgField];
        if (publisher == '') { return '' };
        if (this[apaField] != '') { return this[apaField] };

        let language = this.language;
        let entryType = this.entryType;

        publisher = new itex(publisher);

        if (language == 'zh') {
            switch (entryType) {
                default:
                    publisher = publisher.clear.bold.str;
                    break;
            }
        } else if (language == 'en') {
            switch (entryType) {
                default:
                    publisher = publisher.clear.Title.italic.str;
                    break;
            }
        }

        this[apaField] = publisher;
        return this[apaField];
    }

    get apa_address() { // 地址
        let [apaField, orgField] = this.get_field('address');
        let address = this[orgField];
        if (address == '') { return '' };
        if (this[apaField] != '') { return this[apaField] };

        this[apaField] = address;
        return this[apaField];
    }

    get editor() {
        let [_, orgField] = this.get_field('editor');
        return this[orgField];
    }

    get apa_editors() {
        let editor = this.editor;
        if (editor == '') { return "" }
        editor = new iname(editor);
        return editor.apa_editors;
    }

    get apa_chair() {
        let chair = this.editor;
        if (chair == '') { return "null" }
        chair = new iname(chair);
        return chair.apa_chair;
    }

    get apa_edition() {
        let [apaField, orgField] = this.get_field('edition');
        let edition = this[orgField];
        if (edition == '') { return '' };
        if (this[apaField] != '') { return this[apaField] };

        let language = this.language;
        let entryType = this.entryType;

        let value = new itex(edition);
        value.language = this.language;

        if (language == 'en') {
            switch (entryType) {
                case 'misc':
                    value = value.str;
                    break;
                default:
                    value = value.cirBrackets.str
                    break;
            }
        } else if (language == 'zh') {
            switch (entryType) {
                case 'misc':
                    value = value.str;
                    break;
                default:
                    value = value.cirBrackets.str
                    break;
            }
        }
        this[apaField] = value;
        return this[apaField];
    }

    get apa_howpublished() {
        let [apaField, orgField] = this.get_field('howpublished');
        let howpublished = this[orgField];
        if (howpublished == '') { return '' };
        if (this[apaField] != '') { return this[apaField] };

        let language = this.language;
        let entryType = this.entryType;


        let value = new itex(howpublished);
        value.Language = this.language;

        if (language == 'zh') {
            switch (entryType) {
                default:
                    value = value.bold.str;
                    break;
            }
        } else if (language == 'en') {
            switch (entryType) {
                default:
                    value = value.Title.italic.str;
                    break;
            }
        }
        this[apaField] = value;
        return this[apaField];
    }

    get apa_institution() {
        let [apaField, orgField] = this.get_field('institution');
        let institution = this[orgField];
        if (institution == '') { return '' };
        if (this[apaField] != '') { return this[apaField] };

        this[apaField] = institution;
        return this[apaField];

    }

    get apa_note() {
        let [apaField, orgField] = this.get_field('note');
        let note = this[orgField];
        if (note == '') { return '' };
        if (this[apaField] != '') { return this[apaField] };
        note = new itex(note);
        note = note.url.str;
        this[apaField] = note;
        return this[apaField];
    }

    get apa_school() {
        let [apaField, orgField] = this.get_field('school');
        let school = this[orgField];
        if (school == '') { return '' };
        if (this[apaField] != '') { return this[apaField] };

        this[apaField] = school;
        return this[apaField];
    }

    // organization
    get apa_organization() {
        let [apaField, orgField] = this.get_field('organization');
        let organization = this[orgField];
        if (organization == '') { return '' };
        if (this[apaField] != '') { return this[apaField] };
        this[apaField] = organization;
        return this[apaField];
    }

    get apa_type() {// 会议报告类型
        let [apaField, orgField] = this.get_field('type');
        let type = this[orgField];
        if (type == '') { return '' };
        if (this[apaField] != '') { return this[apaField] };
        let language = this.language;
        let entryType = this.entryType;

        let value = new itex(type);
        value.language = language;


        if (language == 'zh') {
            switch (entryType) {
                default:
                    value = value.squBrackets.str
                    break;
            }
        } else if (language == 'en') {
            switch (entryType) {
                default:
                    value = value.squBrackets.str
                    break;
            }
        }
        this[apaField] = value;
        return this[apaField];
    }

    get apa_url() {//普通 url
        let [apaField, orgField] = this.get_field('url');
        let url = this[orgField];
        if (url == '') { return '' };
        if (this[apaField] != '') { return this[apaField] };

        this[apaField] = `\\url{${url}}`;
        return this[apaField];

    }

    // ----------------- 以下为辅助函数 -----------------
    f_output(tlist, f = ', ') {
        var b = '.';
        var t = '';
        if (this.language == 'zh') {
            switch (f) {
                case ', ':
                    f = '，';
                    break;
                case '. ':
                    f = '。';
                    break;
                case ': ':
                    f = '：';
                    break;
                case '; ':
                    f = '；';
                    break;
                case ' ':
                    f = '';
                    break;
                default:
                    f = '';
                    break;
            }
            b = '。';
        }
        // lsit 去掉值为 '' 的元素\
        tlist = tlist.filter((item) => item != '');
        if (tlist.every((item) => item == '')) { return '' };
        //
        t += '\n\\newblock ';
        t += tlist.join(f);
        t += b;
        return t;

    }

    // ----------------- 以下为输出函数 -----------------
    /**
    @article
    期刊杂志论文
    必要域: author, title, journal, year.
    可选域: volume, number, pages, month, note.

    @article{
        % 以下为必选域
        author={},
        title={},
        journal={},
        year={},
        % 以下为可选域
        volume={},
        number={},
        pages={},
        note={}
    }
    */
    get article() {
        let info = `\\bibitem[${this.apa_citetxt}]{${this.citekey}}`;
        info += this.f_output([this.apa_authors, this.apa_year], ' ')
        info += this.f_output([this.apa_title]);
        info += this.f_output([this.apa_journal, this.apa_volume + this.apa_number, this.apa_pages], ', ')
        info += this.f_output([this.apa_note]);
        info += "\n";
        return info;
    }

    /**
    @book
    公开出版的图书
    必要域: author/editor, title, publisher, year.
    可选域: volume/number, series, address, edition, month, note.

    @book{
        % 以下为必选域
        author={},
        title={},
        publisher={},
        year={},
        % 以下为可选域
        volume={},
        series={},%书籍所属的系列名称或编号
        address={},
        edition={},
        month={},
        note={}
    }
    */
    get book() {// 出现在正文的引用文本+引用id,作者,年份,标题(出版版本),出版社, 
        let info = `\\bibitem[${this.apa_citetxt}]{${this.citekey}}`;
        info += this.f_output([this.apa_authors, this.apa_year], ' ')
        info += this.f_output([this.apa_title, this.apa_series], ', ');
        info += this.f_output([this.apa_address, this.apa_publisher], ': ');
        info += this.f_output([this.apa_note]);
        info += "\n";
        return info;
    }

    /**
    @booklet
    无出版商或作者的图书
    必要域: title.
    可选域: author, howpublished, address, month, year, note.
    */
    get booklet() {
        console.log("unsopoorted type: booklet")
    }

    /**
    @inbook
    书籍的一部分章节
    必要域: author/editor, title, chapter and/or pages, publisher, year.
    可选域: volume/number, series, address, edition, month, note.
    @inbook{
        % 以下为必选域
        author={},
        title={},
        publisher={},
        chapter={},% 或 pages={},
        year={},
        % 以下为可选域
        volume={},
        series={},%书籍所属的系列名称或编号
        address={},
        edition={},
        note={}
    }
    */
    get inbook() {
        let info = `\\bibitem[${this.apa_citetxt}]{${this.citekey}}`;

        info += this.f_output([this.apa_authors, this.apa_year], ' ')
        if (this.org_chapter != '') {
            info += this.f_output([this.apa_title + this.apa_edition, this.apa_chapter, this.apa_series], ', ');
        } else {
            info += this.f_output([this.apa_title + this.apa_edition, this.apa_series, this.apa_pages], ', ');
        }

        info += this.f_output([this.apa_address, this.apa_publisher]);
        info += this.f_output([this.apa_note]);
        info += "\n";
        return info;
    }

    /**
     * @incollection
    书籍中带独立标题的章节
    必要域: author, title, booktitle, publisher, year.
    可选域: editor, volume/number, series, chapter, pages, address, edition, month, note.
    @incollection{
        % 以下为必选域
        author={},
        title={},
        booktitle={},
        publisher={},
        year={},
        % 以下为可选域
        editor={},
        volume={},%或 number={},
        series={},%书籍所属的系列名称或编号
        chapter={},
        address={},
        edition={},
        note={}
    }
    */
    get incollection() {
        if (this.entryType != 'incollection') { return "" };

        let info = `\\bibitem[${this.apa_citetxt}]{${this.citekey}}`;
        info += this.f_output([this.apa_authors, this.apa_year], ' ')
        info += this.f_output([this.apa_title, this.apa_series], ', ');
        info += this.f_output([this.apa_editors, this.apa_booktitle + this.apa_edition + this.apa_pages], ', ');
        info += this.f_output([this.apa_address, this.apa_publisher], ', ');
        info += this.f_output([this.apa_note]);
        info += "\n";
        return info;
    }

    /**
     * @conference
   等价于 inproceedings
   必要域: author, title, booktitle, year.
   可选域: editor, volume/number, series, pages, address, month, organization, publisher, note.
     */
    get conference() {
        let info = `\\bibitem[${this.apa_citetxt}]{${this.citekey}}`;
        info += this.f_output([this.apa_authors, this.apa_year], ' ')
        info += this.f_output([this.apa_title]);
        info += this.f_output([this.apa_editors, this.apa_booktitle + this.apa_pages], ', ');
        info += this.f_output([this.apa_series, this.apa_address, this.apa_publisher,], ', ');
        info += this.f_output([this.apa_note]);
        info += "\n";
        return info;
    }

    get inproceedings() {
        return this.conference;
    }

    /**
    @proceedings
    会议论文集
    必要域: title, year.
    可选域: editor, volume/number, series, address, month, organization, publisher, note.
    */
    get proceedings() {
        console.log("unsopoorted type: proceedings")
    }

    /**
    @phdthesis
    必要域: author, title, year, school.
    可选域: address, month, keywords, note.
    */
    get phdthesis() {
        let info = `\\bibitem[${this.apa_citetxt}]{${this.citekey}}`;
        info += this.f_output([this.apa_authors, this.apa_year], ' ')
        info += this.f_output([this.apa_title]);
        info += this.f_output([this.apa_address, this.apa_school], ", ");
        info += this.f_output([this.apa_note]);
        info += "\n";
        return info;
    }

    get mastersthesis() {
        let info = `\\bibitem[${this.apa_citetxt}]{${this.citekey}}`;
        info += this.f_output([this.apa_authors, this.apa_year], ' ')
        info += this.f_output([this.apa_title]);
        info += this.f_output([this.apa_address, this.apa_school], ", ");
        info += this.f_output([this.apa_note]);
        info += "\n";
        return info;
    }

    /**
     * @manual
    技术文档
    必要域: title.
    可选域: author, organization, address, edition, month, year, note.
     */
    get manual() {
        console.log("unsopoorted type: manual")
    }

    /**
     * @techreport
    教育，商业机构的技术报告
    必要域: author, title, institution, year.
    可选域: type, number, address, month, note.
     */
    get techreport() {
        let info = `\\bibitem[${this.apa_citetxt}]{${this.citekey}}`;
        info += this.f_output([this.apa_authors, this.apa_year], ' ')
        info += this.f_output([this.apa_title + this.apa_type]);
        info += this.f_output([this.apa_institution]);
        info += this.f_output([this.apa_note]);
        info += "\n";
        return info;
    }

    /**
 *     @unpublished
    未出版的论文，图书
    必要域: author, title, note.
    可选域: month, year.
     */
    get unpublished() {
        let info = `\\bibitem[${this.apa_citetxt}]{${this.citekey}}`;
        info += this.f_output([this.apa_authors, this.apa_year], ' ')
        info += this.f_output([this.apa_title]);
        info += this.f_output([this.apa_note]);
        info += "\n";
        return info;
    }

    get misc() {
        let info = `\\bibitem[${this.apa_citetxt}]{${this.citekey}}`;
        info += this.f_output([this.apa_authors, this.apa_year], ' ')
        info += this.f_output([this.apa_title + this.apa_edition]);
        info += this.f_output([this.apa_journal, this.apa_howpublished, this.apa_volume, this.apa_number, this.apa_pages], ',')
        info += this.f_output([this.apa_note]);
        info += "\n";
        return info;

    }


    get output_bib() {
        // 遍历所有的属性，如果 包含''org 字符串，则保留
        let t = `@${this.entryType}{${this.citekey},\n`;
        let UN = BIB[this.entryType]['UN'];
        let NUN = BIB[this.entryType]['UN'] + BIB[this.entryType]['N'];

        for (let key in this) {
            if (key.includes('org_')) {
                //如果 key 在bib 中
                let k = key.replace('org_', '');
                if (!NUN.includes(k)) {
                    continue;
                }
                if (UN.includes(k) && this[key] == '') {
                    continue;
                }
                t += `    ${k} = {${this[key]}},\n`;
            }
        }
        t += '}\n';

        return t;
    }

    get output_bbl() {
        let t = '';
        switch (this.entryType) {
            case 'article':// article: 期刊或杂志上的文章
                return this.article;
            case 'book': // book: 书籍
                return this.book;
            case 'booklet':// booklet: 和book一样，但没有指定的出版商
                return this.booklet;
            case 'inbook':// inbook: 书中的一章或一节
                return this.inbook;
            case 'unpublished':// unpublished: 尚未正式出版的作品
                return this.unpublished;
            case 'manual':// manual: 技术手册
                return this.manual;
            case 'masterthesis':// masterthesis: 硕士论文
                return this.masterthesis;
            case 'phdthesis':// phdthesis: 博士论文
                return this.phdthesis;
            case 'conference':// conference: 会议论文
                return this.conference;
            case 'inproceedings':// inproceedings: 会议论文与 conference 相同
                return this.conference;
            case 'incollection':// incollection: 论文集中的文章
                return this.incollection;
            case 'proceedings':// proceedings: 整个会议记录
                return this.proceedings;
            case 'techreport'://  techreport: 技术报告，政府报告或白皮书
                return this.techreport;
            case 'misc':// misc: 如果没有其他合适的可以使用，则使用 misc，比如网址，邮件等。
                return this.misc;
            case 'patent':// patent: 专利
                return this.misc;
            default:
                return this.misc;
        }
    }
}

class read_bib {
    constructor(bibtxt) {
        this.bibtxt = bibtxt;
        this.citekey_list = [];
        this._recitekey = 0;
        this.sortby = 'must';


    }

    get recitekey() {
        return this._recitekey;
    }

    set recitekey(val) {
        this._recitekey = val;
    }


    get to_bbl() {
        return this.__bbl();
    }

    get to_bib() {
        return this.__bib();
    }

    get citekeys() {
        return this.citekey_list.join(", ")
    }

    get to_yearbib() {
        return this.__yearbib();
    }

    _formatbib(bibtxt) {
        // 计算元素出现在数组中多少次
        function countOccurrences(arr, val) {
            return arr.reduce((count, item) => {
                return count + (item === val);
            }, 0);
        }

        //分割bib txt,  以 @ 开头, 以 @ 结尾
        const at_pos = [...bibtxt.matchAll(/@/g)].map(m => m.index);
        let res = at_pos.map((pos, i) => bibtxt.slice(pos, at_pos[i + 1])).filter(x => x !== undefined);

        var bib_dict = {
            "en": {}, "zh": {}
        };

        let count_list = [];
        let inds = 'abcdefghijklmnopqrstuvwxyz'

        let duplicate = [];
        this.citekey_list = [];
        //遍历 res 
        for (let i = 0; i < res.length; i++) {
            var tembib = res[i].split('\n').filter(line => line.trim() !== '' && !line.trim().startsWith('%')).join('\n');

            let t = new anybib(tembib);

            if (this.recitekey >= 1) {
                // 将变量 i 转换为字符串,长度为3,不足前面补0
                let ni = `${i}`.padStart(3, '0');
                t.citekey = `ref${ni}`;
            }
            // 用于输出所有的 citekey
            this.citekey_list.push(t.citekey);

            //  实现排序,中文按笔画, 英文按字母
            let citetxt = t.apa_citetxt;
            let title = t.apa_title;

            // 按 引用文本加标题判断是否重复, 如果重复, 则跳过
            if (duplicate.includes(citetxt + title)) {
                continue;
            }
            duplicate.push(citetxt + title);

            //  主要用于判断作者年份都一样,但是标题不一样的情况,当0:a,1:b,...
            let n = 0;

            if (t.language == "zh") {
                let num = strokes.indexOf(citetxt[0])
                if (num == -1) { num = 9999; }
                let yearnum = t.year
                if (isNaN(yearnum)) { yearnum = 9999; }
                let numj = `${num}${yearnum}${n}`

                if (bib_dict['zh'][citetxt] == undefined) {
                    t['year_suffix'] = "";
                    bib_dict['zh'][citetxt] = [numj, t];
                } else {
                    // 将重复的元素添加到 count_list 中
                    count_list.push(citetxt)
                    n = countOccurrences(count_list, citetxt);
                    numj = `${num}${yearnum}${n}`
                    let nn = inds[n]
                    // 找出 t.apa_year 字符串的连续4位数字, 并在年份的后面添加 nn
                    t.apa_citetxt_suffix(nn);
                    t.apa_year_suffix(nn);
                    t['year_suffix'] = nn;
                    bib_dict['zh'][`${citetxt}${nn}`] = [numj, t];
                }
            } else {
                citetxt = citetxt.toLowerCase();
                let num = strokes.indexOf(citetxt[0])
                let num1 = strokes.indexOf(citetxt[1])
                if (num == -1) { num = 9999; }
                if (num1 == -1) { num1 = 9999; }
                let yearnum = t.year;
                if (isNaN(yearnum)) { yearnum = 9999; }
                let numj = `${num}${num1}${yearnum}${n}`;


                if (bib_dict['en'][citetxt] == undefined) {
                    t['year_suffix'] = "";
                    bib_dict['en'][citetxt] = [numj, t];
                } else {
                    // 将重复的元素添加到 count_list 中
                    count_list.push(citetxt);
                    n = countOccurrences(count_list, citetxt);
                    numj = `${num}${num1}${yearnum}${n}`;

                    let nn = inds[n]
                    // 找出 t.apa_year 字符串的连续4位数字, 并在年份的后面添加 nn
                    t.apa_citetxt_suffix(nn);
                    t.apa_year_suffix(nn);
                    t['year_suffix'] = nn;
                    bib_dict['en'][`${citetxt}${nn}`] = [numj, t];
                }
            }
        }
        // count_list 去重
        count_list = [...new Set(count_list)]
        // count_list 为空
        if (count_list.length != 0) {
            // 遍历 count_list, 如果元素在biblist['zh']的key中, 则是取出值,并删除
            for (let i = 0; i < count_list.length; i++) {
                if (count_list[i] in bib_dict['zh']) {
                    let tem = bib_dict['zh'][count_list[i]]
                    tem[1].apa_citetxt_suffix('a');
                    tem[1].apa_year_suffix('a');
                    tem[1]['year_suffix'] = 'a';
                    bib_dict['zh'][`${count_list[i]}a`] = [tem[0], tem[1]]
                    delete bib_dict['zh'][count_list[i]]
                }
                if (count_list[i] in bib_dict['en']) {
                    let tem = bib_dict['en'][count_list[i]]
                    tem[1].apa_citetxt_suffix('a');
                    tem[1].apa_year_suffix('a');
                    tem[1]['year_suffix'] = 'a';
                    bib_dict['en'][`${count_list[i]}a`] = [tem[0], tem[1]]
                    delete bib_dict['en'][count_list[i]]

                }
            }
        }

        // 重命名 citekey
        if (this.recitekey > 0) {
            bib_dict = this.__rename_citekey(bib_dict);
        }


        // 输出 bib_dict en 有多少个元素
        this.numofzhbib = Object.keys(bib_dict['zh']).length;
        this.numofenbib = Object.keys(bib_dict['en']).length;

        return bib_dict;
    }

    __rename_citekey(bib_dict) {
        let zh = bib_dict['zh'];
        let en = bib_dict['en'];
        this.citekey_list = [];
        // 遍历 zh 的值, 将值的第二个元素的 citekey 重命名
        let o = 0;
        for (let i = 0; i < Object.values(zh).length; i++) {
            let tem = Object.values(zh)[i][1];
            let s = tem.apa_citetxt[0];
            s = strokes.indexOf(s)
            s = strokes_py[s];
            if (s == undefined) {
                s = "undefined"
            }
            let syear = tem.year;
            //从 syear 中提取4个数字
            let reg = /\d{4}/;
            syear = reg.exec(syear);
            if (syear == null) {
                syear = "9999"
            } else {
                syear = syear[0]
            }


            let nn = tem.year_suffix;

            tem.citekey = `${s}${syear}${nn}`;
            // 
            if (this.citekey_list.includes(tem.citekey)) {
                o += 1;
                tem.citekey = `${s}${o}${syear}${nn}`;
            }
            this.citekey_list.push(tem.citekey)
            Object.values(zh)[i][1] = tem;

        }
        for (let i = 0; i < Object.values(en).length; i++) {
            let tem = Object.values(en)[i][1];
            let s = tem.apa_citetxt;
            if (s.indexOf(",")) {
                s = s.split(",")[0];
                if (s.indexOf(" ")) {
                    s = s.split(" ")[0].toLowerCase();
                }
            } else {
                s = 'undefined'
            }
            let syear = tem.year;
            let reg = /\d{4}/;
            syear = reg.exec(syear);
            if (syear == null) {
                syear = "9999"
            } else {
                syear = syear[0]
            }
            let nn = tem.year_suffix;
            tem.citekey = `${s}${syear}${nn}`;
            if (this.citekey_list.includes(tem.citekey)) {
                o += 1;
                tem.citekey = `${s}${o}${syear}${nn}`;
            }
            this.citekey_list.push(tem.citekey)

            Object.values(en)[i][1] = tem;
        }



        return bib_dict
    }

    __sort_must() {
        let bib_dict = this.bib_dict;
        let biblist_zh = '';
        let biblist_en = '';
        biblist_zh = Object.entries(bib_dict['zh']).sort((a, b) => a[1][0] - b[1][0]).map(x => x[1][1])
        biblist_en = Object.entries(bib_dict['en']).sort((a, b) => a[1][0] - b[1][0]).map(x => x[1][1])
        return [biblist_zh, biblist_en]
    }

    __sort_year() {
        let bib_dict = this.bib_dict;
        // biblist['zh'] 与 biblist['en']  合并
        let biblist_all = Object.assign(bib_dict['zh'], bib_dict['en'])
        // biblist_all 取出所值的第三个元素
        let biblist_all_values = Object.values(biblist_all).map(x => x[1])
        // 遍历 biblist_all_values 的元素
        let biblist_all_values_sort = biblist_all_values.sort((a, b) => {
            // 如果 a.year 与 b.year 都是数字, 则按照数字排序
            if (!isNaN(a.year) && !isNaN(b.year)) {
                return b.year - a.year
            }
            // 如果 a.year 与 b.year 都不是数字, 则按照字符串排序
            if (isNaN(a.year) && isNaN(b.year)) {
                return a.year.localeCompare(b.year)
            }
            // 如果 a.year 是数字, b.year 不是数字, 则 a.year 排在 b.year 的后面
            if (!isNaN(a.year) && isNaN(b.year)) {
                return 1
            }
            // 如果 a.year 不是数字, b.year 是数字, 则 a.year 排在 b.year 的前面
            if (isNaN(a.year) && !isNaN(b.year)) {
                return -1
            }
        })
        return [biblist_all_values_sort, '']
    }

    __sort_citekey() {
        let bib_dict = this.bib_dict;
        // biblist['zh'] 与 biblist['en']  合并
        let biblist_all = Object.assign(bib_dict['zh'], bib_dict['en'])
        // biblist_all 取出所值的第三个元素
        let biblist_all_values = Object.values(biblist_all).map(x => x[1])
        // 遍历 biblist_all_values 的元素
        let biblist_all_values_sort = biblist_all_values.sort((a, b) => {
            // 如果 a.year 与 b.year 都是数字, 则按照数字排序
            if (!isNaN(a.citekey) && !isNaN(b.year)) {
                return b.citekey - a.citekey
            }
            // 如果 a.citekey 与 b.citekey 都不是数字, 则按照字符串排序
            if (isNaN(a.citekey) && isNaN(b.citekey)) {
                return a.citekey.localeCompare(b.citekey)
            }
            // 如果 a.citekey 是数字, b.citekey 不是数字, 则 a.citekey 排在 b.citekey 的后面
            if (!isNaN(a.citekey) && isNaN(b.citekey)) {
                return 1
            }
            // 如果 a.citekey 不是数字, b.citekey 是数字, 则 a.citekey 排在 b.citekey 的前面
            if (isNaN(a.citekey) && !isNaN(b.citekey)) {
                return -1
            }
        })
        return [biblist_all_values_sort, '']
    }

    __sort() {
        switch (this.sortby) {
            case 'must':
                return this.__sort_must()
            case 'year':
                return this.__sort_year()
            case 'citekey':
                return this.__sort_citekey()
        }
    }

    __bbl() {
        let bibtxt = this.bibtxt

        this.bib_dict = this._formatbib(bibtxt);

        let [biblist_zh, biblist_en] = this.__sort();

        let zhbbl = [];
        for (let i = 0; i < biblist_zh.length; i++) {
            zhbbl.push(biblist_zh[i].output_bbl);
        }

        let enbbl = [];
        for (let i = 0; i < biblist_en.length; i++) {
            enbbl.push(biblist_en[i].output_bbl);
        }

        let a = `\\bibitem[zh, 2019]{zh2019}{\\fontsize{16pt}{\\baselineskip}\\selectfont{中文部分：}}`
        a += `\n{\\large\\linespread{1.485}\\selectfont \n`

        let b = `}`
        if (zhbbl.length > 0) {
            //  在 zhbbl 数组, 第一个位置上 添加元素
            zhbbl.unshift(a);
            //  在 zhbbl 数组, 最后一个位置上 添加元素
            zhbbl.push(b);
        }

        a = `\\bibitem[En, 2019]{en2019}{\\fontsize{16pt}{\\baselineskip}\\selectfont{英文部分：}}`
        a += `\n{\\normalsize\\linespread{1.083333333333}\\selectfont \n`

        b = `} `
        if (enbbl.length > 0) {
            enbbl.unshift(a);
            enbbl.push(b);
        }

        let allbll = [zhbbl.join('\n'), enbbl.join('\n')]
        //allbbl 去空元素
        allbll = allbll.filter(line => line.trim() !== '' && !line.trim().startsWith('%'));
        allbll = allbll.join('\n\n\\clearpage\n')
        let bbl = `\\begin{thebibliography} {} \n`
        bbl += allbll
        bbl += `\n\n\\end{thebibliography} `;
        return bbl
    }

    __bib() {
        let bibtxt = this.bibtxt

        this.bib_dict = this._formatbib(bibtxt);

        let [biblist_zh, biblist_en] = this.__sort();

        let zhbbl = [];
        if (biblist_zh != '') {
            for (let i = 0; i < biblist_zh.length; i++) {
                zhbbl.push(biblist_zh[i].output_bib);
            }
        }
        let enbbl = [];
        if (biblist_en != '') {
            for (let i = 0; i < biblist_en.length; i++) {
                enbbl.push(biblist_en[i].output_bib);
            }
        }
        // zhbbl & enbbl 合并输出字符
        let allbll = [zhbbl.join('\n'), enbbl.join('\n')]
        //allbbl 去空元素
        allbll = allbll.filter(line => line.trim() !== '' && !line.trim().startsWith('%'));
        allbll = allbll.join('\n\n')
        return allbll
    }
}




let bibtxt = `
@phdthesis{ref002,
    author = {鄭夢},
    title = {跨文化交際視閾下韓國孔子學院漢語教師志願者專業化發展研究},
    year = {2021},
    school = {吉林大學},
}

@phdthesis{ref003,
    author = {鄭夺},
    title = {韓國高中漢語教材教師用書研究——以《中國語1教師用書》為例},
    year = {2021},
    school = {蘭州交通大學},
}

@phdthesis{ref004,
    author = {鄭在},
    title = {韓國CPIK教師跨文化適應調查研究},
    year = {2021},
    school = {南京師範大學},
}

@phdthesis{ref005,
    author = {鄭载真},
    title = {韓國CPIK 獨立教學項目漢語教師教學情況的考察與分析},
    year = {2021},
    school = {福建師範大學},
}

@article{ref006,
    author = {Alujevi´c, M.; Braovi´c Plavša, M},
    year = {2021},
    title = {The effect of psychotypology and linguistic attitudes towards target language on the occurrence of transfer on the receptive level upon the first contact of croatian speakers with italian as L2},
    journal = {Journal of Language and Literary Studies},
    volume = {XII},
    pages = {249–270},
}

@phdthesis{ref007,
    author = {李暖},
    title = {基於中韓漢語教師合作的尚志女子高中文化教學研究},
    year = {2020},
    school = {東北師範大學},
}

@article{ref008,
    author = {崔永華},
    year = {2020},
    title = {對外漢語教學的目標是培養漢語跨文化交際能力},
    journal = {語言教學與研究},
    number = {4},
    pages = {12},
}

@phdthesis{ref009,
    author = {劉彥伶},
    title = {赴韓漢語教師志願者跨文化言語交際案例分析},
    year = {2020},
    school = {云南师范大学},
}

@article{ref010,
    author = {Guo, Jiaqi and Liu, Yongcan},
    year = {2020},
    title = {Navigating the complex landscape of cross-epistemic climates: migrant Chinese language teachers’ belief changes about knowledge and learning},
    journal = {Teacher Development},
    volume = {24},
    number = {4},
    pages = {483--501},
}

@article{ref011,
    author = {Makarova, Elena and Birman, Dina and others},
    year = {2020},
    title = {Teachers as risk and resource factors in minority students’ school adjustment: An integrative review of qualitative research on acculturation},
    journal = {Acculturation and School Adjustment of Minority Students},
    pages = {4--33},
}

@article{ref012,
    author = {Burgess, Julianne and Rowsell, Jennifer},
    year = {2020},
    title = {Transcultural-affective flows and multimodal engagements: Reimagining pedagogy and assessment with adult language learners},
    journal = {Language and education},
    volume = {34},
    number = {2},
    pages = {173--191},
}

@book{ref013,
    author = {Allen, Kelly-Ann},
    title = {The psychology of belonging},
    publisher = {Routledge},
    year = {2020},
}

@article{ref014,
    author = {Paolillo, Rocco and Jager, Wander},
    year = {2020},
    title = {Simulating acculturation dynamics between migrants and locals in relation to network formation},
    journal = {Social Science Computer Review},
    volume = {38},
    number = {4},
    pages = {365--386},
}

@article{ref016,
    author = {Benet-Mart{'i}nez, Ver{'o}nica and Repke, Lydia},
    year = {2020},
    title = {Broadening the social psychological approach to acculturation: cultural, personality and social-network approaches (Ampliaci{'o}n del enfoque socio-psicol{'o}gico de la aculturaci{'o}n: perspectivas cultural, de la personalidad y de las redes sociales},
    journal = {International Journal of Social Psychology},
    volume = {35},
    number = {3},
    pages = {526--559},
}

@article{ref015,
    author = {Benet-Mart{'i}nez, Ver{'o}nica and Repke, Lydia},
    year = {2020},
    title = {Broadening the social psychological approach to acculturation: cultural, personality and social-network approaches (Ampliaci{'o}n del enfoque socio-psicol{'o}gico de la aculturaci{'o}n: perspectivas cultural, de la personalidad y de las redes sociales},
    journal = {International Journal of Social Psychology},
    volume = {35},
    number = {3},
    pages = {526--559},
}

@phdthesis{ref017,
    author = {胡青梅},
    title = {赴韩汉语志愿者跨文化交际案例研究},
    year = {2019},
    school = {},
}

@phdthesis{ref018,
    author = {许依莹},
    title = {对外汉语教师入职期跨文化适应研究},
    year = {2019},
    school = {浙江科技学院},
}

@article{ref019,
    author = {戴晓东},
    year = {2019},
    title = {跨文化能力理论发展六十年:历程与展望},
    journal = {外语界},
    number = {4},
    pages = {9},
}

@phdthesis{ref020,
    author = {陈淼},
    title = {赴韩汉语教师志愿者跨文化适应状况研究},
    year = {2019},
    school = {大连外国语大学},
}

@article{ref021,
    author = {李曉紅, \& 王瑞芳},
    year = {2019},
    title = {教學理念對教師教學行為的影響研究},
    journal = {教育教學論壇},
    number = {22},
    pages = {68-69},
}

@article{ref022,
    author = {Bayraktar, Secil},
    year = {2019},
    title = {A diary study of expatriate adjustment: Collaborative mechanisms of social support},
    journal = {International Journal of Cross Cultural Management},
    volume = {19},
    number = {1},
    pages = {47--70},
}

@article{ref023,
    author = {Brailovskaia, Julia and Sch{"o}nfeld, Pia and Kochetkov, Yakov and Margraf, J{"u}rgen},
    year = {2019},
    title = {What does migration mean to us? USA and Russia: Relationship between migration, resilience, social support, happiness, life satisfaction, depression, anxiety and stress},
    journal = {Current Psychology},
    volume = {38},
    number = {2},
    pages = {421--431},
}

@article{ref024,
    author = {Hua, Jing and Fan, Jinyan and Walker, Alan and Hou, Ning and Zheng, Lu and Debode, Jason},
    year = {2019},
    title = {Examinations of the role of individual adaptability in cross-cultural adjustment},
    journal = {Journal of Career Assessment},
    volume = {27},
    number = {3},
    pages = {490--509},
}

@book{ref025,
    author = {World Health Organization},
    title = {Global status report on alcohol and health 2018},
    publisher = {World Health Organization},
    year = {2019},
}

@article{ref026,
    author = {C{'a}rdenas, Diana and De la Sablonni{'e}re, Roxane and Gorborukova, Galina L and Mageau, Genevi{'e}ve A and Amiot, Catherine E and Sadykova, Nazgul},
    year = {2019},
    title = {Participation in a new cultural group and patterns of identification in a globalized world: The moderating role of similarity},
    journal = {Self and Identity},
    volume = {18},
    number = {6},
    pages = {709--738},
}

@article{ref027,
    author = {Min, Wonjung and Jin, Dal Yong and Han, Benjamin},
    year = {2019},
    title = {Transcultural fandom of the Korean Wave in Latin America: through the lens of cultural intimacy and affinity space},
    journal = {Media, Culture \& Society},
    volume = {41},
    number = {5},
    pages = {604--619},
}

@phdthesis{ref028,
    author = {刘宁},
    title = {韩国全罗北道汉语教师志愿者调查研究},
    year = {2018},
    school = {黑龙江大学},
}

@phdthesis{ref029,
    author = {唐叶岚},
    title = {2017年韩国CPIK汉语教师志愿者跨文化适应问题研究},
    year = {2018},
    school = {西北师范大学},
}

@phdthesis{ref030,
    author = {曾捡飞},
    title = {赴韩汉语教师志愿者跨文化适应研究},
    year = {2018},
    school = {广东外语外贸大学},
}

@article{ref031,
    author = {陆茵茵},
    year = {2018},
    title = {赴新西兰汉语教师志愿者跨文化适应研究},
    journal = {厦门大学},
}

@article{ref033,
    author = {胡范铸 and 陈佳璇 and 张虹倩},
    year = {2018},
    title = {目标设定、路径选择、队伍建设:新时代汉语国际教育的重新认识简},
    journal = {世界汉语教学},
}

@article{ref032,
    author = {胡范铸 and 陈佳璇 and 张虹倩},
    year = {2018},
    title = {目标设定、路径选择、队伍建设:新时代汉语国际教育的重新认识简},
    journal = {世界汉语教学},
}

@article{ref034,
    author = {Wang, Zhongmin and Jing, Xinlin},
    year = {2018},
    title = {Job satisfaction among immigrant workers: A review of determinants},
    journal = {Social indicators research},
    volume = {139},
    number = {1},
    pages = {381--401},
}

@article{ref035,
    author = {Abayadeera, Nadana and Mihret, Dessalegn Getie and Hewa Dulige, Jayasinghe},
    year = {2018},
    title = {Teaching effectiveness of non-native English-speaking teachers in business disciplines: intercultural communication apprehension and ethnocentrism},
    journal = {Accounting Education},
    volume = {27},
    number = {2},
    pages = {183--207},
}

@article{ref036,
    author = {Hou, Feng and Schellenberg, Grant and Berry, John},
    year = {2018},
    title = {Patterns and determinants of immigrants’ sense of belonging to Canada and their source country},
    journal = {Ethnic and Racial Studies},
    volume = {41},
    number = {9},
    pages = {1612--1631},
}

@phdthesis{ref037,
    author = {王一聪},
    title = {赴韩汉语志愿者教师跨文化交际个案研究},
    year = {2017},
    school = {河南师范大学},
}

@article{ref038,
    author = {李茨婷},
    year = {2017},
    title = {国际汉语教师跨文化教学能力研究述评简},
    journal = {高教发展与评估},
    volume = {33},
    number = {5},
    pages = {10},
}

@article{ref039,
    author = {潘雪扬},
    year = {2017},
    title = {对外汉语教师在厄瓜多尔的跨文化适应},
    journal = {北方文学：中},
    number = {7},
    pages = {2},
}

@article{ref040,
    author = {Bornstein and  Marc, H},
    year = {2017},
    title = {The Specificity Principle in Acculturation Science},
    journal = {Perspect Psychol},
    volume = {12},
    number = {1},
    pages = {3-45},
}

@article{ref041,
    author = {Rehm, J{"u}rgen and Gmel Sr, Gerhard E and Gmel, Gerrit and Hasan, Omer SM and Imtiaz, Sameer and Popova, Svetlana and Probst, Charlotte and Roerecke, Michael and Room, Robin and Samokhvalov, Andriy V and others},
    year = {2017},
    title = {The relationship between different dimensions of alcohol use and the burden of disease—an update},
    journal = {Addiction},
    volume = {112},
    number = {6},
    pages = {968--1001},
}

@phdthesis{ref042,
    author = {赵婷婷},
    title = {韩国CPIK留任志愿者和离任志愿者跨文化适应研究},
    year = {2016},
    school = {广西大学},
}

@book{ref043,
    author = {宋擎擎},
    title = {韩国传统文化概览},
    publisher = {延边大学出版社},
    year = {2015},
}

@book{ref001,
    author = {宋擎擎},
    title = {韩国民族文化性格探究},
    publisher = {韩国民族文化性格探究},
    year = {2015},
}

@phdthesis{ref044,
    author = {周丹},
    title = {韩国中小学汉语志愿者教师教学适应性调查},
    year = {2015},
    school = {广东外语外贸大学},
}

@article{ref045,
    author = {李泉 and 宫雪},
    year = {2015},
    title = {通用型、区域型、语别型、国别型——谈国际汉语教材的多元化},
    journal = {汉语学习},
    number = {1},
    pages = {9},
}

@article{ref046,
    author = {陈向明},
    year = {2015},
    title = {扎根理论在中国教育研究中的运用探索},
    journal = {北京大学教育评论},
    volume = {13},
    number = {1},
    pages = {14},
}

@book{ref047,
    author = {王烨},
    title = {中国古代礼仪},
    publisher = {中国古代礼仪},
    year = {2015},
}

@book{ref048,
    author = {李佑成},
    title = {韩国的历史肖像},
    publisher = {山东大学出版社},
    year = {2015},
}

@article{ref049,
    author = {Wang, Q. E},
    year = {2015},
    title = {Chopsticks: A cultural and culinary history},
    journal = {},
}

@article{ref050,
    author = {Dai, Xiaodong and Chen, Guo-Ming},
    year = {2015},
    title = {On Interculturality and Intercultural Communication Competence},
    journal = {China Media Research},
    volume = {11},
    number = {3},
}

@article{ref051,
    author = {Barker, Gina G},
    year = {2015},
    title = {Choosing the best of both worlds: The acculturation process revisited},
    journal = {International Journal of Intercultural Relations},
    volume = {45},
    pages = {56--69},
}

@article{ref052,
    author = {Salo, Corrina D and Birman, Dina},
    year = {2015},
    title = {Acculturation and psychological adjustment of Vietnamese refugees: An ecological acculturation framework},
    journal = {American journal of community psychology},
    volume = {56},
    pages = {395--407},
}

@article{ref053,
    author = {Selmer, Jan and Lauring, Jakob},
    year = {2015},
    title = {Host country language ability and expatriate adjustment: The moderating effect of language difficulty},
    journal = {The International Journal of Human Resource Management},
    volume = {26},
    number = {3},
    pages = {401--420},
}

@article{ref054,
    author = {Adams, Byron G and Van de Vijver, Fons JR},
    year = {2015},
    title = {The many faces of expatriate identity},
    journal = {International Journal of Intercultural Relations},
    volume = {49},
    pages = {322--331},
}

@article{ref055,
    author = {Ko, Jungyai and Frey, Jodi Jacobson and Osteen, Philip and Ahn, Haksoon},
    year = {2015},
    title = {Moderating effects of immigrant status on determinants of job satisfaction: Implications for occupational health},
    journal = {Journal of Career Development},
    volume = {42},
    number = {5},
    pages = {396--411},
}

@article{ref056,
    author = {Wang, Huiying and Xie, Yimin},
    year = {2015},
    title = {Critical Factors for Acculturation of Overseas Learners of Chinese: a Reconstruction of Cultural Structure},
    journal = {ASR CHIANG MAI UNIVERSITY JOURNAL OF SOCIAL SCIENCES AND HUMANITIES},
    volume = {2},
    number = {2},
    pages = {139--153},
}

@article{ref057,
    author = {Stokke, Anna},
    year = {2015},
    title = {What to Do About Canada's Declining Math Scores},
    journal = {CD Howe Institute Commentary},
    volume = {427},
}

@article{ref058,
    author = {Sullivan, Ann Marie},
    year = {2015},
    title = {Cultural heritage \& new media: a future for the past},
    journal = {J. Marshall Rev. Intell. Prop. L},
    volume = {15},
    pages = {604},
}

@article{ref059,
    author = {任仕超 and 梁文霞},
    year = {2014},
    title = {中外远程协作课程对跨文化交际能力影响的实证研究},
    journal = {外语界},
    number = {6},
    pages = {8},
}

@article{ref060,
    author = {李鹏},
    year = {2014},
    title = {亲历赴美汉语教师志愿者工作},
    journal = {公共外交季刊},
    number = {3},
    pages = {6},
}

@book{ref061,
    author = {金光熙},
    title = {大韩民国史},
    publisher = {大韩民国史},
    year = {2014},
}

@article{ref062,
    author = {Lau, D. C.  and  Long, W. L.  and  Wen, S. S},
    year = {2014},
    title = {Examining the effects of feeling trusted by supervisors in the workplace: A self-evaluative perspective},
    journal = {John Wiley \& Sons, Ltd},
    number = {1},
}

@article{ref063,
    author = {Cao, Lan and Hirschi, Andreas and Deller, J{"u}rgen},
    year = {2014},
    title = {Perceived organizational support and intention to stay in host countries among self-initiated expatriates: The role of career satisfaction and networks},
    journal = {The International Journal of Human Resource Management},
    volume = {25},
    number = {14},
    pages = {2013--2032},
}

@article{ref064,
    author = {Nolan, Eimear Marie and Morley, Michael J},
    year = {2014},
    title = {A test of the relationship between person--environment fit and cross-cultural adjustment among self-initiated expatriates},
    journal = {The International Journal of Human Resource Management},
    volume = {25},
    number = {11},
    pages = {1631--1649},
}

@article{ref065,
    author = {Mahajan, Ashish and Toh, Soo Min},
    year = {2014},
    title = {Facilitating expatriate adjustment: The role of advice-seeking from host country nationals},
    journal = {Journal of World Business},
    volume = {49},
    number = {4},
    pages = {476--487},
}

@article{ref066,
    author = {Jordan, Adam},
    year = {2014},
    title = {John Dewey on education: Impact \& theory},
    journal = {Study. com. July},
    volume = {8},
}

@article{ref067,
    author = {Allen, Jennifer Dacey and Caspi, Caitlin and Yang, May and Leyva, Bryan and Stoddard, Anne M and Tamers, Sara and Tucker-Seeley, Reginald D and Sorensen, Glorian C},
    year = {2014},
    title = {Pathways between acculturation and health behaviors among residents of low-income housing: The mediating role of social and contextual factors},
    journal = {Social science \& medicine},
    volume = {123},
    pages = {26--36},
}

@article{ref068,
    author = {Shield, Kevin D and Parry, Charles and Rehm, J{"u}rgen},
    year = {2014},
    title = {Chronic diseases and conditions related to alcohol use},
    journal = {Alcohol research: current reviews},
    volume = {35},
    number = {2},
    pages = {155},
}

@article{ref070,
    author = {Koveshnikov, Alexei and Wechtler, Heidi and Dejoux, Cecile},
    year = {2014},
    title = {Cross-cultural adjustment of expatriates: The role of emotional intelligence and gender},
    journal = {Journal of World Business},
    volume = {49},
    number = {3},
    pages = {362--371},
}

@article{ref069,
    author = {Koveshnikov, A.  and  Wechtler, H.  and  Dejoux, C},
    year = {2014},
    title = {Cross-cultural adjustment of expatriates: The role of emotional intelligence and gender},
    journal = {Journal of World Business},
    volume = {49},
    number = {3},
    pages = {362-371},
}

@article{ref071,
    author = {戴晓东},
    year = {2013},
    title = {解读跨文化认同的四种视角},
    journal = {学术研究},
    number = {9},
    pages = {144--151},
}

@article{ref072,
    author = {刘涛 and 刘富华},
    year = {2013},
    title = {国际汉语教师课堂教学能力培训策略研究},
    journal = {东北师大学报：哲学社会科学版},
    number = {1},
    pages = {4},
}

@inproceedings{ref073,
    author = {安然},
    year = {2013},
    title = {孔子学院中方人员跨文化适应能力理论模式建构},
    booktitle = {中国跨文化交际国际学术研讨会},
}

@article{ref074,
    author = {魏慧萍},
    year = {2013},
    title = {当代语境下的汉韩共有汉字词汇研究},
    journal = {中国学论丛},
    pages = {20},
}

@article{ref075,
    author = {Wilson, Jessie and Ward, Colleen and Fischer, Ronald},
    year = {2013},
    title = {Beyond culture learning theory: What can personality tell us about cultural competence},
    journal = {Journal of cross-cultural psychology},
    volume = {44},
    number = {6},
    pages = {900--927},
}

@article{ref076,
    author = {张红玲},
    year = {2012},
    title = {以跨文化教育为导向的外语教学:历史,现状与未来},
    journal = {外语界},
    number = {2},
    pages = {6},
}

@article{ref077,
    author = {吕俞辉 and 汝淑媛},
    year = {2012},
    title = {对外汉语教师海外工作跨文化适应研究},
    journal = {云南师范大学学报(对外汉语教学与研究版},
    volume = {10},
    number = {01},
    pages = {44-45},
}

@book{ref078,
    author = {房列曙},
    title = {中国近现代文化史专题研究},
    publisher = {安徽师范大学出版社},
    year = {2012},
}

@book{ref079,
    author = {李鹤飞},
    title = {中韩文化概述},
    publisher = {中国商务出版社},
    year = {2012},
}

@article{ref080,
    author = {Froese, Fabian Jintae and Peltokorpi, Vesa and Ko, Kyung A},
    year = {2012},
    title = {The influence of intercultural communication on cross-cultural adjustment and work attitudes: Foreign workers in South Korea},
    journal = {International Journal of Intercultural Relations},
    volume = {36},
    number = {3},
    pages = {331--342},
}

@article{ref081,
    author = {Verkuyten, Maykel and Martinovic, Borja},
    year = {2012},
    title = {Immigrants’ national identification: Meanings, determinants, and consequences},
    journal = {Social Issues and Policy Review},
    volume = {6},
    number = {1},
    pages = {82--112},
}

@article{ref082,
    author = {Koo Moon, Hyoung and Kwon Choi, Byoung and Shik Jung, Jae},
    year = {2012},
    title = {Previous international experience, cross-cultural training, and expatriates' cross-cultural adjustment: Effects of cultural intelligence and goal orientation},
    journal = {Human resource development quarterly},
    volume = {23},
    number = {3},
    pages = {285--330},
}

@article{ref083,
    author = {Rojas Tejada, Antonio J and Cruz del Pino, Raquel M and Tatar, Moshe and Jim{'e}nez Say{'a}ns, Pablo},
    year = {2012},
    title = {“Spanish as a foreign language” teachers’ profiles: inclusive beliefs, teachers’ perceptions of student outcomes in the TCLA program, burnout, and experience},
    journal = {European journal of psychology of education},
    volume = {27},
    pages = {285--298},
}

@article{ref084,
    author = {Martinovic, Borja and Verkuyten, Maykel},
    year = {2012},
    title = {Host national and religious identification among Turkish Muslims in Western Europe: The role of ingroup norms, perceived discrimination and value incompatibility},
    journal = {European Journal of Social Psychology},
    volume = {42},
    number = {7},
    pages = {893--903},
}

@book{ref085,
    author = {Lineberry, Matthew},
    title = {Expatriates' acculturation strategies: Going beyond" How adjusted are you?" to" How do you adjust},
    publisher = {University of South Florida},
    year = {2012},
}

@book{ref086,
    author = {Creswell, John W},
    title = {Educational research: Planning, conducting, and evaluating quantitative and qualitative research},
    publisher = {Pearson Education, Inc},
    year = {2012},
}

@misc{ref087,
    title = {The global religious landscape. Pew Research Center},
    author = {Hackett, C and Grim, BJ and Stonawski, M and Skirbekk, V and Potan{{c}}okov{'a}, M and Connor, P},
    year = {2012},
}

@article{ref088,
    author = {Thoma, Myriam V and Ryf, Stefan and Mohiyeddini, Changiz and Ehlert, Ulrike and Nater, Urs M},
    year = {2012},
    title = {Emotion regulation through listening to music in everyday situations},
    journal = {Cognition \& emotion},
    volume = {26},
    number = {3},
    pages = {550--560},
}

@article{ref089,
    author = {Kim, Junhyoung},
    year = {2012},
    title = {Exploring the experience of intergroup contact and the value of recreation activities in facilitating positive intergroup interactions of immigrants},
    journal = {Leisure Sciences},
    volume = {34},
    number = {1},
    pages = {72--87},
}

@article{ref090,
    author = {Falk, John H and Ballantyne, Roy and Packer, Jan and Benckendorff, Pierre},
    year = {2012},
    title = {Travel and learning: A neglected tourism research area},
    journal = {Annals of Tourism Research},
    volume = {39},
    number = {2},
    pages = {908--927},
}

@phdthesis{ref091,
    author = {祝婕},
    title = {在韩汉语教师志愿者跨文化适应影响因素的实证分析},
    year = {2011},
    school = {山东大学},
}

@article{ref092,
    author = {戴晓东},
    year = {2011},
    title = {跨文化交际理论从欧洲中心到多中心演进探析},
    journal = {学术研究},
    number = {3},
    pages = {10},
}

@book{ref093,
    author = {韩国历史研究会 and 尚咏梅 and 王海龙},
    title = {百年韩国 生活与文化},
    publisher = {百年韩国  生活与文化},
    year = {2011},
}

@article{ref094,
    author = {Brown, R.  and  Zagefka, H},
    year = {2011},
    title = {The Dynamics of Acculturation},
    journal = {Advances in Experimental Social Psychology},
    volume = {44},
    pages = {129-184},
}

@article{ref095,
    author = {Froese, Fabian Jintae and Peltokorpi, Vesa},
    year = {2011},
    title = {Cultural distance and expatriate job satisfaction},
    journal = {International Journal of Intercultural Relations},
    volume = {35},
    number = {1},
    pages = {49--60},
}

@article{ref096,
    author = {Wu, Pei-Chuan and Ang, Siah Hwee},
    year = {2011},
    title = {The impact of expatriate supporting practices and cultural intelligence on cross-cultural adjustment and performance of expatriates in Singapore},
    journal = {The International Journal of Human Resource Management},
    volume = {22},
    number = {13},
    pages = {2683--2702},
}

@article{ref097,
    author = {Ditzfeld, Christopher P and Showers, Carolin J},
    year = {2011},
    title = {Emotional processing in categorization: Understanding the cognitive structure of the self},
    journal = {Social Cognition},
    volume = {29},
    number = {2},
    pages = {111--124},
}

@article{ref098,
    author = {Badea, Constantina and Jetten, Jolanda and Iyer, Aarti and Er-Rafiy, Abdelatif},
    year = {2011},
    title = {Negotiating dual identities: The impact of group-based rejection on identification and acculturation},
    journal = {European Journal of Social Psychology},
    volume = {41},
    number = {5},
    pages = {586--595},
}

@article{ref099,
    author = {Berry, John W and Sabatier, Colette},
    year = {2011},
    title = {Variations in the assessment of acculturation attitudes: Their relationships with psychological wellbeing},
    journal = {International journal of intercultural relations},
    volume = {35},
    number = {5},
    pages = {658--669},
}

@article{ref100,
    author = {贺圣达},
    year = {2010},
    title = {东亚文化圈和东亚价值观的历史考察——以中日韩(朝)越为主体的历史分析},
    journal = {东南亚纵横},
    number = {4},
    pages = {11},
}

@book{ref101,
    author = {秦桂芳},
    title = {韩国文化概论},
    publisher = {韩国文化概论},
    year = {2010},
}

@article{ref102,
    author = {田景 and 黄亨奎 and 池福淑 and 白承镐},
    year = {2010},
    title = {韩国文化论},
    journal = {中 山 大 学 出 版 社 2010 年 版},
}

@article{ref103,
    author = {Froese, Fabian Jintae},
    year = {2010},
    title = {Acculturation experiences in Korea and Japan},
    journal = {Culture \& Psychology},
    volume = {16},
    number = {3},
    pages = {333--348},
}

@article{ref104,
    author = {Suinn, Richard M},
    year = {2010},
    title = {Reviewing acculturation and Asian Americans: How acculturation affects health, adjustment, school achievement, and counseling},
    journal = {Asian American Journal of Psychology},
    volume = {1},
    number = {1},
    pages = {5},
}

@article{ref105,
    author = {Schulz, Renate A and Ganz, Alexander},
    year = {2010},
    title = {Developing Professional Consensus on the Teaching of Culture: Report on a Survey of Secondary and Postsecondary German Teachers 1},
    journal = {Die Unterrichtspraxis/Teaching German},
    volume = {43},
    number = {2},
    pages = {175--193},
}

@book{ref106,
    author = {Beard, Colin},
    title = {The experiential learning toolkit: Blending practice with concepts},
    publisher = {Kogan Page Publishers},
    year = {2010},
}

@article{ref107,
    author = {Kappe, Rutger and van der Flier, Henk},
    year = {2010},
    title = {Using multiple and specific criteria to assess the predictive validity of the Big Five personality factors on academic performance},
    journal = {Journal of Research in Personality},
    volume = {44},
    number = {1},
    pages = {142--145},
}

@article{ref108,
    author = {Chae, Mark H and Foley, Pamela F},
    year = {2010},
    title = {Relationship of ethnic identity, acculturation, and psychological well-being among Chinese, Japanese, and Korean Americans},
    journal = {Journal of Counseling \& Development},
    volume = {88},
    number = {4},
    pages = {466--476},
}

@article{ref109,
    author = {Leung, Angela Ka-yee and Chiu, Chi-yue},
    year = {2010},
    title = {Multicultural experience, idea receptiveness, and creativity},
    journal = {Journal of Cross-Cultural Psychology},
    volume = {41},
    number = {5-6},
    pages = {723--741},
}

@article{ref112,
    author = {Sam, David L and Berry, John W},
    year = {2010},
    title = {Acculturation: When individuals and groups of different cultural backgrounds meet},
    journal = {Perspectives on psychological science},
    volume = {5},
    number = {4},
    pages = {472--481},
}

@article{ref113,
    author = {Lueck, Kerstin and Wilson, Machelle},
    year = {2010},
    title = {Acculturative stress in Asian immigrants: The impact of social and linguistic factors},
    journal = {International Journal of Intercultural Relations},
    volume = {34},
    number = {1},
    pages = {47--57},
}

@article{ref110,
    author = {Sam, David L and Berry, John W},
    year = {2010},
    title = {Acculturation: When individuals and groups of different cultural backgrounds meet},
    journal = {Perspectives on psychological science},
    volume = {5},
    number = {4},
    pages = {472--481},
}

@article{ref111,
    author = {Lueck, Kerstin and Wilson, Machelle},
    year = {2010},
    title = {Acculturative stress in Asian immigrants: The impact of social and linguistic factors},
    journal = {International Journal of Intercultural Relations},
    volume = {34},
    number = {1},
    pages = {47--57},
}

@book{ref114,
    author = {毕继万},
    title = {跨文化交际与第二语言教学},
    publisher = {跨文化交际与第二语言教学},
    year = {2009},
}

@book{ref115,
    author = {杨军红},
    title = {来华留学生跨文化适应问题研究},
    publisher = {来华留学生跨文化适应问题研究},
    year = {2009},
}

@book{ref116,
    author = {杨昭全},
    title = {韩国文化史},
    publisher = {山东大学出版社},
    year = {2009},
}

@article{ref117,
    author = {Pascoe, Elizabeth A and Smart Richman, Laura},
    year = {2009},
    title = {Perceived discrimination and health: a meta-analytic review},
    journal = {Psychological bulletin},
    volume = {135},
    number = {4},
    pages = {531},
}

@article{ref118,
    author = {Brandl, Julia and Neyer, Anne-Katrin},
    year = {2009},
    title = {Applying cognitive adjustment theory to cross-cultural training for global virtual teams},
    journal = {Human Resource Management: Published in Cooperation with the School of Business Administration, The University of Michigan and in alliance with the Society of Human Resources Management},
    volume = {48},
    number = {3},
    pages = {341--353},
}

@article{ref119,
    author = {Wiltermuth, Scott S and Heath, Chip},
    year = {2009},
    title = {Synchrony and cooperation},
    journal = {Psychological science},
    volume = {20},
    number = {1},
    pages = {1--5},
}

@article{ref120,
    author = {Peltokorpi, Vesa},
    year = {2008},
    title = {Cross-cultural adjustment of expatriates in Japan},
    journal = {The International Journal of Human Resource Management},
    volume = {19},
    number = {9},
    pages = {1588--1606},
}

@article{ref121,
    author = {Kim, Young Yun},
    year = {2008},
    title = {Intercultural personhood: Globalization and a way of being},
    journal = {International journal of intercultural relations},
    volume = {32},
    number = {4},
    pages = {359--368},
}

@article{ref122,
    author = {李泉},
    year = {2007},
    title = {论对外汉语教材的实用性},
    journal = {语言教学与研究},
    number = {3},
    pages = {28--35},
}

@article{ref123,
    author = {Rathje and Stefanie},
    year = {2007},
    title = {Intercultural Competence: The Status and Future of a Controversial Concept},
    journal = {Language \& Intercultural Communication},
    volume = {7},
    number = {4},
    pages = {254-266},
}

@article{ref124,
    author = {Peltokorpi, Vesa},
    year = {2007},
    title = {Intercultural communication patterns and tactics: Nordic expatriates in Japan},
    journal = {International Business Review},
    volume = {16},
    number = {1},
    pages = {68--82},
}

@article{ref125,
    author = {Takeuchi, Riki and Lepak, David P and Marinova, Sophia V and Yun, Seokhwa},
    year = {2007},
    title = {Nonlinear influences of stressors on general adjustment: the case of Japanese expatriates and their spouses},
    journal = {Journal of International Business Studies},
    volume = {38},
    pages = {928--943},
}

@article{ref126,
    author = {Lee, Richard M and Noh, Chi-Young and Yoo, Hyung Chol and Doh, Hyun-Sim},
    year = {2007},
    title = {The psychology of diaspora experiences: Intergroup contact, perceived discrimination, and the ethnic identity of Koreans in China},
    journal = {Cultural Diversity and Ethnic Minority Psychology},
    volume = {13},
    number = {2},
    pages = {115},
}

@book{ref127,
    author = {Holton},
    title = {The Sage handbook of grounded theory},
    publisher = {Los Angeles, CA: Sage},
    year = {2007},
    series = {The coding process and its challenges},
}

@article{ref128,
    author = {Gerring, J},
    year = {2007},
    title = {Case Study Research, Principles and Practices Cambridge University Press},
    journal = {New York},
}

@book{ref129,
    author = {Mann, Prem S},
    title = {Introductory statistics},
    publisher = {John Wiley \& Sons},
    year = {2007},
}

@book{ref130,
    author = {Logan, William S},
    title = {Closing Pandora's box: human rights conundrums in cultural heritage protection},
    publisher = {Springer},
    year = {2007},
}

@book{ref131,
    author = {Forbes, Bruce David},
    title = {Christmas: A candid history},
    publisher = {Univ of California Press},
    year = {2007},
}

@article{ref000,
    author = {甘瑞瑗},
    year = {2006},
    title = {国别化"对外汉语教学用词表"制定的研究:以韩国为例},
    journal = {语言文字应用},
    number = {02},
}

@article{ref132,
    author = {张英},
    year = {2006},
    title = {对外汉语文化因素与文化知识教学研究},
    journal = {汉语学习},
    number = {6},
    pages = {7},
}

@article{ref133,
    author = {Bakker, Winny and Van Der Zee, Karen and Van Oudenhoven, Jan Pieter},
    year = {2006},
    title = {Personality and Dutch emigrants' reactions to acculturation strategies},
    journal = {Journal of Applied Social Psychology},
    volume = {36},
    number = {12},
    pages = {2864--2891},
}

@article{ref134,
    author = {Berry, J. W},
    year = {2006},
    title = {Stress perspectives on acculturation},
    journal = {},
}

@article{ref135,
    author = {Selmer, Jan},
    year = {2006},
    title = {Language ability and adjustment: Western expatriates in China},
    journal = {Thunderbird International Business Review},
    volume = {48},
    number = {3},
    pages = {347--368},
}

@article{ref136,
    author = {Benet-Mart{'i}nez, Ver{'o}nica and Lee, Fiona and Leu, Janxin},
    year = {2006},
    title = {Biculturalism and cognitive complexity: Expertise in cultural representations},
    journal = {Journal of Cross-Cultural Psychology},
    volume = {37},
    number = {4},
    pages = {386--407},
}

@article{ref137,
    author = {Beiser, Morton},
    year = {2006},
    title = {Longitudinal research to promote effective refugee resettlement},
    journal = {Transcultural psychiatry},
    volume = {43},
    number = {1},
    pages = {56--71},
}

@article{ref138,
    author = {Pedraza, Silvia and others},
    year = {2006},
    title = {Assimilation or transnationalism? Conceptual models of the immigrant experience in America},
    journal = {Cultural psychology of immigrants},
    pages = {33--54},
}

@book{ref139,
    author = {Charmaz, Kathy},
    title = {Constructing grounded theory: A practical guide through qualitative analysis},
    publisher = {sage},
    year = {2006},
}

@article{ref140,
    author = {Trochim, William MK},
    year = {2006},
    title = {Ethics in research},
    journal = {Research methods knowledge base},
    pages = {112--112},
}

@article{ref141,
    author = {McCarthy, Patricia R and McCarthy, Henry M},
    year = {2006},
    title = {When case studies are not enough: Integrating experiential learning into business curricula},
    journal = {Journal of Education for business},
    volume = {81},
    number = {4},
    pages = {201--204},
}

@book{ref142,
    author = {Ward, Colleen  and  Bochner, S.  and  Furnham, Adrian},
    title = {The Psychology of Culture Shock},
    publisher = {The Psychology of Culture Shock},
    year = {2005},
}

@article{ref143,
    author = {Tania, C.  and  Theorizing, G.  and  William, B.  and  Oaks, C},
    year = {2005},
    title = {Gallois, and Howard Giles},
    journal = {Communication Accommodation Theory A Look Back \& A Look Ahead in Intercultural Communication Thousand Sage Pp},
}

@article{ref144,
    author = {Locher, Julie L and Yoels, William C and Maurer, Donna and Van Ells, Jillian},
    year = {2005},
    title = {Comfort foods: an exploratory journey into the social and emotional significance of food},
    journal = {Food \& Foodways},
    volume = {13},
    number = {4},
    pages = {273--297},
}

@book{ref145,
    author = {Hofstede, Geert and Hofstede, Gert Jan and Minkov, Michael},
    title = {Cultures and organizations: Software of the mind},
    publisher = {Mcgraw-hill New York},
    year = {2005},
    volume = {2},
}

@book{ref146,
    author = {George, Alexander L and Bennett, Andrew},
    title = {Case studies and theory development in the social sciences},
    publisher = {mit Press},
    year = {2005},
}

@article{ref147,
    author = {Mol, Stefan T and Born, Marise Ph and Willemsen, Madde E and Van Der Molen, Henk T},
    year = {2005},
    title = {Predicting expatriate job performance for selection purposes: A quantitative review},
    journal = {Journal of Cross-Cultural Psychology},
    volume = {36},
    number = {5},
    pages = {590--620},
}

@article{ref148,
    author = {Verbeke, Wim and Poquiviqui Lopez, Gisela},
    year = {2005},
    title = {Ethnic food attitudes and behaviour among Belgians and Hispanics living in Belgium},
    journal = {British food journal},
    volume = {107},
    number = {11},
    pages = {823--840},
}

@article{ref150,
    author = {Bhaskar-Shrinivas, Purnima  and  Harrison, David A.  and  Shaffer, Margaret A.  and  Luk, Dora M},
    year = {2005},
    title = {INPUT-BASED AND TIME-BASED MODELS OF INTERNATIONAL ADJUSTMENT: META-ANALYTIC EVIDENCE AND THEORETICAL EXTENSIONS},
    journal = {Academy of Management Journal},
}

@article{ref149,
    author = {Bhaskar-Shrinivas, Purnima  and  Harrison, David A.  and  Shaffer, Margaret A.  and  Luk, Dora M},
    year = {2005},
    title = {INPUT-BASED AND TIME-BASED MODELS OF INTERNATIONAL ADJUSTMENT: META-ANALYTIC EVIDENCE AND THEORETICAL EXTENSIONS},
    journal = {Academy of Management Journal},
}

@book{ref151,
    author = {陈向明},
    title = {旅居者和"外国人":留美中国学生跨文化人际交往研究},
    publisher = {旅居者和“外国人”:留美中国学生跨文化人际交往研究},
    year = {2004},
}

@article{ref152,
    author = {全香兰},
    year = {2004},
    title = {汉韩同形词偏误分析},
    journal = {汉语学习},
    number = {3},
    pages = {6},
}

@article{ref153,
    author = {张英},
    year = {2004},
    title = {对外汉语文化教材研究——兼论对外汉语文化教学等级大纲建设},
    journal = {汉语学习},
    number = {1},
    pages = {7},
}

@book{ref154,
    author = {杨昭全},
    title = {中国--朝鲜・韩国文化交流史},
    publisher = {昆仑出版社},
    year = {2004},
    volume = {1},
}

@article{ref155,
    author = {李泉},
    year = {2004},
    title = {论对外汉语教材的针对性},
    journal = {世界汉语教学},
    number = {2},
    pages = {49--57},
}

@article{ref156,
    author = {郑定欧},
    year = {2004},
    title = {论面向对外汉语教学的基础研究},
    journal = {汉语学习},
    number = {5},
    pages = {50--55},
}

@article{ref157,
    author = {Mak, Anita S and Blewitt, Kelly and Heaven, Patrick CL},
    year = {2004},
    title = {Gender and personality influences in adolescent threat and challenge appraisals and depressive symptoms},
    journal = {Personality and Individual Differences},
    volume = {36},
    number = {6},
    pages = {1483--1496},
}

@book{ref158,
    author = {Sandra M. Fowler \& Judith M. Blohm},
    title = {Handbook of Intercutural Training},
    publisher = {SAGE Publications, Inc},
    year = {2004},
    series = {An analysis of methods for intercultural training},
}

@article{ref159,
    author = {Wang, Xiaoyun and Kanungo, Rabindra N},
    year = {2004},
    title = {Nationality, social network and psychological well-being: Expatriates in China},
    journal = {The International Journal of Human Resource Management},
    volume = {15},
    number = {4-5},
    pages = {775--793},
}

@article{ref160,
    author = {Acker, Gila M},
    year = {2004},
    title = {The effect of organizational conditions (role conflict, role ambiguity, opportunities for professional development, and social support) on job satisfaction and intention to leave among social workers in mental health care},
    journal = {Community mental health journal},
    volume = {40},
    pages = {65--73},
}

@article{ref162,
    author = {Den Brok, Perry and Brekelmans, Mieke and Wubbels, Theo},
    year = {2004},
    title = {Interpersonal teacher behaviour and student outcomes},
    journal = {School effectiveness and school improvement},
    volume = {15},
    number = {3-4},
    pages = {407--442},
}

@article{ref161,
    author = {Den Brok, Perry and Brekelmans, Mieke and Wubbels, Theo},
    year = {2004},
    title = {Interpersonal teacher behaviour and student outcomes},
    journal = {School effectiveness and school improvement},
    volume = {15},
    number = {3-4},
    pages = {407--442},
}

@article{ref163,
    author = {陈慧 and 车宏生 and 朱敏},
    year = {2003},
    title = {跨文化适应影响因素研究述评},
    journal = {心理科学进展},
    volume = {11},
    number = {6},
    pages = {704-710},
}

@book{ref164,
    author = {金生鈜},
    title = {德性与敎化: 从苏格拉底到尼采: 西方道德敎育哲学思想硏究},
    publisher = {湖南大学出版社},
    year = {2003},
}

@book{ref165,
    author = {杨方},
    title = {第四条思路: 西方伦理学若干问题宏观综合研究},
    publisher = {湖南大学出版社},
    year = {2003},
}

@article{ref166,
    author = {Rudmin, Floyd W},
    year = {2003},
    title = {Critical history of the acculturation psychology of assimilation, separation, integration, and marginalization},
    journal = {Review of general psychology},
    volume = {7},
    number = {1},
    pages = {3--37},
}

@article{ref167,
    author = {Richardson, Virginia},
    year = {2003},
    title = {Constructivist pedagogy},
    journal = {Teachers college record},
    volume = {105},
    number = {9},
    pages = {1623--1640},
}

@article{ref168,
    author = {张辉女},
    year = {2002},
    title = {汉字和汉语与朝鲜半岛语言的关系},
    journal = {民族语文},
    number = {5},
    pages = {59--65},
}

@article{ref169,
    author = {Fuchs, E.  and  Stuchtey, B},
    year = {2002},
    title = {Across cultural borders : historiography in global perspective},
    journal = {History \& Theory},
    volume = {42},
    number = {3},
    pages = {425-425},
}

@article{ref170,
    author = {Skinner, Natalie and Brewer, Neil},
    year = {2002},
    title = {The dynamics of threat and challenge appraisals prior to stressful achievement events},
    journal = {Journal of personality and social psychology},
    volume = {83},
    number = {3},
    pages = {678},
}

@article{ref171,
    author = {Copeland, Anne P and Norell, Sara K},
    year = {2002},
    title = {Spousal adjustment on international assignments: The role of social support},
    journal = {International Journal of Intercultural Relations},
    volume = {26},
    number = {3},
    pages = {255--272},
}

@article{ref173,
    author = {Takeuchi, Riki and Yun, Seokhwa and Tesluk, Paul E},
    year = {2002},
    title = {An examination of crossover and spillover effects of spousal and expatriate cross-cultural adjustment on expatriate outcomes},
    journal = {Journal of applied psychology},
    volume = {87},
    number = {4},
    pages = {655},
}

@article{ref172,
    author = {Takeuchi, Riki  and  Yun, Seokhwa  and  Tesluk, Paul E},
    year = {2002},
    title = {An examination of crossover and spillover effects of spousal and expatriate cross-cultural adjustment on expatriate outcomes},
    journal = {Journal of Applied Psychology},
    volume = {87},
    number = {4},
    pages = {655-66},
}

@book{ref174,
    author = {仓道来 and 徐闻},
    title = {中西方青年价值观的冲撞与交融},
    publisher = {中西方青年价值观的冲撞与交融},
    year = {2001},
}

@book{ref176,
    author = {杨昭全},
    title = {中国--朝鲜・韩国关系史},
    publisher = {天津人民出版社},
    year = {2001},
    volume = {2},
}

@book{ref175,
    author = {杨昭全},
    title = {中国——朝鲜·韩国关系史 (上册},
    publisher = {天津人民出版社},
    year = {2001},
}

@article{ref177,
    author = {Eschbach, Doris M and Parker, Gerald E and Stoeberl, Philipp A},
    year = {2001},
    title = {American repatriate employees' retrospective assessments of the effects of cross-cultural training on their adaptation to international assignments},
    journal = {International Journal of Human resource management},
    volume = {12},
    number = {2},
    pages = {270--287},
}

@article{ref178,
    author = {Kerem, Efrat and Fishman, Nurit and Josselson, Ruthellen},
    year = {2001},
    title = {The experience of empathy in everyday relationships: Cognitive and affective elements},
    journal = {Journal of Social and Personal Relationships},
    volume = {18},
    number = {5},
    pages = {709--729},
}

@article{ref179,
    author = {Morris, Mark A and Robie, Chet},
    year = {2001},
    title = {A meta-analysis of the effects of cross-cultural training on expatriate performance and adjustment},
    journal = {International Journal of Training and Development},
    volume = {5},
    number = {2},
    pages = {112--125},
}

@article{ref180,
    author = {Kraimer, Maria L and Wayne, Sandy J and Jaworski, Ren Ata A},
    year = {2001},
    title = {Sources of support and expatriate performance: The mediating role of expatriate adjustment},
    journal = {Personnel psychology},
    volume = {54},
    number = {1},
    pages = {71--99},
}

@article{ref181,
    author = {Caligiuri, Paula and Phillips, Jean and Lazarova, Mila and Tarique, Ibraiz and Burgi, Peter},
    year = {2001},
    title = {The theory of met expectations applied to expatriate adjustment: The role of crosscultural training},
    journal = {International Journal of Human Resource Management},
    volume = {12},
    number = {3},
    pages = {357--372},
}

@book{ref182,
    author = {Liebkind, K},
    title = {Blackwell handbook of social psychology},
    publisher = {Oxford, United Kingdom: Blackwell},
    year = {2001},
    series = {Acculturation},
}

@book{ref183,
    author = {Sohn, Ho-Min},
    title = {The korean language},
    publisher = {Cambridge University Press},
    year = {2001},
}

@book{ref184,
    author = {Ting-Toomey, Stella and Oetzel, John G},
    title = {Managing intercultural conflict effectively},
    publisher = {Sage},
    year = {2001},
    volume = {5},
}

@article{ref185,
    author = {Polletta, Francesca and Jasper, James M},
    year = {2001},
    title = {Collective identity and social movements},
    journal = {Annual review of Sociology},
    volume = {27},
    number = {1},
    pages = {283--305},
}

@article{ref186,
    author = {Casper, Michele},
    year = {2001},
    title = {A definition of “social environment},
    journal = {American journal of public health},
    volume = {91},
    number = {3},
    pages = {465--470},
}

@book{ref188,
    author = {Kim, Y. Y},
    title = {Becoming intercultural : an integrative theory of communication and cross-cultural adaptation},
    publisher = {Becoming intercultural : an integrative theory of communication and cross-cultural adaptation},
    year = {2001},
}

@book{ref187,
    author = {Kim, Y. Y},
    title = {Becoming intercultural : an integrative theory of communication and cross-cultural adaptation},
    publisher = {Becoming intercultural : an integrative theory of communication and cross-cultural adaptation},
    year = {2001},
}

@book{ref189,
    author = {陈向明},
    title = {质的研究方法与社会科学研究},
    publisher = {质的研究方法与社会科学研究},
    year = {2000},
}

@article{ref190,
    author = {Segall, MH and Dasen, PR and Berry, JW and Poortinga, YH},
    year = {2000},
    title = {Human behavior in global perspective: An introduction to cross-cultural psychology},
    journal = {Adolescence},
    volume = {35},
    number = {139},
    pages = {603},
}

@book{ref191,
    author = {Chafetz, Janet Saltzman and Ebaugh, Helen Rose},
    title = {Religion and the new immigrants: Continuities and adaptations in immigrant congregations},
    publisher = {AltaMira Press},
    year = {2000},
}

@article{ref192,
    author = {Yavas, Ugur and Bodur, Muzaffer},
    year = {1999},
    title = {Correlates of adjustment: A study of expatriate managers in an emerging country},
    journal = {Management Decision},
    volume = {37},
    number = {3},
    pages = {267--279},
}

@article{ref193,
    author = {Shaffer, Margaret A and Harrison, David A and Gilley, K Matthew},
    year = {1999},
    title = {Dimensions, determinants, and differences in the expatriate adjustment process},
    journal = {Journal of international business studies},
    volume = {30},
    pages = {557--581},
}

@article{ref194,
    author = {Florkowski, Gary W and Fogel, Daniel S},
    year = {1999},
    title = {Expatriate adjustment and commitment: The role of host-unit treatment},
    journal = {International Journal of Human Resource Management},
    volume = {10},
    number = {5},
    pages = {783--807},
}

@book{ref195,
    author = {Huberman, Michael},
    title = {Understanding and preventing teacher burnout: A sourcebook of international research and practice},
    publisher = {Cambridge University Press},
    year = {1999},
}

@article{ref196,
    author = {Wilk, Richard R},
    year = {1999},
    title = {" Real Belizean food": building local identity in the transnational caribbean},
    journal = {American anthropologist},
    volume = {101},
    number = {2},
    pages = {244--255},
}

@book{ref197,
    author = {Warner, Stephen and Wittner, Judith G},
    title = {Gatherings in diaspora: Religious communities and the new immigration},
    publisher = {Temple University Press},
    year = {1998},
}

@book{ref198,
    author = {Gao, Ge and Ting-Toomey, Stella},
    title = {Communicating effectively with the Chinese},
    publisher = {Sage Publications},
    year = {1998},
}

@article{ref199,
    author = {Bhawuk, Dharm PS},
    year = {1998},
    title = {The role of culture theory in cross-cultural training: A multimethod study of culture-specific, culture-general, and culture theory-based assimilators},
    journal = {Journal of cross-cultural psychology},
    volume = {29},
    number = {5},
    pages = {630--655},
}

@book{ref200,
    author = {岳介先},
    title = {世纪的交融与选择},
    publisher = {世纪的交融与选择},
    year = {1997},
}

@article{ref201,
    author = {Ones, D. S.  and  Viswesvaran, C},
    year = {1997},
    title = {Personality determinants in the prediction of aspects of expatriate job success},
    journal = {Aycan Zeynep New Approaches to Employee Management},
    volume = {3},
    number = {8},
    pages = {63-92},
}

@article{ref202,
    author = {Johnson, DL and others},
    year = {1997},
    title = {Meanings of Environmental Terms in Journal of Environmental Quality},
    journal = {},
}

@article{ref204,
    author = {Berry, John W},
    year = {1997},
    title = {Lead article: Immigration, acculturation, and adaptation},
    journal = {Applied psychology: An international review},
    volume = {46},
    number = {1},
    pages = {5--68},
}

@article{ref203,
    author = {Berry, John W},
    year = {1997},
    title = {Immigration, acculturation, and adaptation},
    journal = {Applied psychology},
    volume = {46},
    number = {1},
    pages = {5--34},
}

@article{ref205,
    author = {Aycan and Zeynep and Berry and John and W},
    year = {1996},
    title = {Impact of employment-related experiences on immigrants' psychological well-being and adaptation to Canada},
    journal = {Canadian Journal of Behavioural Science/revue Canadienne Des Sciences Du Comportement},
}

@article{ref206,
    author = {任远},
    year = {1995},
    title = {新一代基础汉语教材编写理论与编写实践},
    journal = {语言教学与研究},
    number = {2},
    pages = {14},
}

@article{ref207,
    author = {Baumeister, Roy F and Leary, Mark R},
    year = {1995},
    title = {The need to belong: desire for interpersonal attachments as a fundamental human motivation},
    journal = {Psychological bulletin},
    volume = {117},
    number = {3},
    pages = {497},
}

@article{ref208,
    author = {Bhawuk, DPS},
    year = {1995},
    title = {The role of cultural theory in cross-cultural training: A comparative evaluation of cultural-specific, culture general, and theory-based assimilators},
    journal = {Unpublished doctoral dissertation, University of Illinois, Urbana-Champaign},
}

@article{ref209,
    author = {Dona, Giorgia and Berry, John W},
    year = {1994},
    title = {Acculturation attitudes and acculturative stress of Central American refugees},
    journal = {International journal of psychology},
    volume = {29},
    number = {1},
    pages = {57--70},
}

@article{ref211,
    author = {Ward, Colleen and Kennedy, Antony},
    year = {1994},
    title = {Acculturation strategies, psychological adjustment, and sociocultural competence during cross-cultural transitions},
    journal = {International journal of intercultural relations},
    volume = {18},
    number = {3},
    pages = {329--343},
}

@article{ref210,
    author = {Ward, Colleen and Kennedy, Antony},
    year = {1994},
    title = {Acculturation strategies, psychological adjustment, and sociocultural competence during cross-cultural transitions},
    journal = {International journal of intercultural relations},
    volume = {18},
    number = {3},
    pages = {329--343},
}

@article{ref212,
    author = {Parker, Barbara and McEvoy, Glenn M},
    year = {1993},
    title = {Initial examination of a model of intercultural adjustment},
    journal = {International journal of intercultural relations},
    volume = {17},
    number = {3},
    pages = {355--379},
}

@book{ref213,
    author = {Erlandson, David A and Harris, Edward L and Skipper, Barbara L and Allen, Steve D},
    title = {Doing naturalistic inquiry: A guide to methods},
    publisher = {Sage},
    year = {1993},
}

@article{ref214,
    author = {McCrae, Robert R and John, Oliver P},
    year = {1992},
    title = {An introduction to the five-factor model and its applications},
    journal = {Journal of personality},
    volume = {60},
    number = {2},
    pages = {175--215},
}

@article{ref215,
    author = {Black, J. S.  and  Mendenhall, M.  and  Oddou, G},
    year = {1991},
    title = {TOWARD A COMPREHENSIVE MODEL OF INTERNATIONAL ADJUSTMENT: AN INTEGRATION OF MULTIPLE THEORETICAL PERSPECTIVES},
    journal = {Academy of Management Review},
    volume = {16},
    number = {2},
    pages = {291-317},
}

@article{ref216,
    author = {Brewer, Marilynn B},
    year = {1991},
    title = {The social self: On being the same and different at the same time},
    journal = {Personality and social psychology bulletin},
    volume = {17},
    number = {5},
    pages = {475--482},
}

@article{ref218,
    author = {Koester, Jolene and Lustig, Myron W},
    year = {1991},
    title = {Communication curricula in the multicultural university},
    journal = {Communication Education},
    volume = {40},
    number = {3},
    pages = {250--254},
}

@article{ref217,
    author = {Koester, Jolene and Lustig, Myron W},
    year = {1991},
    title = {Communication curricula in the multicultural university},
    journal = {Communication Education},
    volume = {40},
    number = {3},
    pages = {250--254},
}

@article{ref219,
    author = {Black, J Stewart and Mendenhall, Mark},
    year = {1990},
    title = {Cross-cultural training effectiveness: A review and a theoretical framework for future research},
    journal = {Academy of management review},
    volume = {15},
    number = {1},
    pages = {113--136},
}

@article{ref220,
    author = {Black, J Stewart and Stephens, Gregory K},
    year = {1989},
    title = {The influence of the spouse on American expatriate adjustment and intent to stay in Pacific Rim overseas assignments},
    journal = {Journal of management},
    volume = {15},
    number = {4},
    pages = {529--544},
}

@article{ref222,
    author = {Berry, John W and Kim, Uichol and Power, Steven and Young, Marta and Bujaki, Merridee},
    year = {1989},
    title = {Acculturation attitudes in plural societies},
    journal = {Applied psychology},
    volume = {38},
    number = {2},
    pages = {185--206},
}

@article{ref221,
    author = {Berry, John W and Kim, Uichol and Power, Steven and Young, Marta and Bujaki, Merridee},
    year = {1989},
    title = {Acculturation attitudes in plural societies},
    journal = {Applied psychology},
    volume = {38},
    number = {2},
    pages = {185--206},
}

@article{ref223333333333333,
    author = {Yoshikawa, Muneo J},
    year = {1988},
    title = {Cross-cultural adaptation and perceptual development},
    journal = {Cross-cultural adaptation: Current approaches},
    pages = {140--148},
}

@article{ref224,
    author = {Fischler, Claude},
    year = {1988},
    title = {Food, self and identity},
    journal = {Social science information},
    volume = {27},
    number = {2},
    pages = {275--292},
}

@book{ref225,
    author = {Weightman, Gavin and Humphries, Stephen},
    title = {Christmas past},
    publisher = {Sidgwick \& Jackson},
    year = {1988},
}

@article{ref226,
    author = {Salton, Gerard and Buckley, Christopher},
    year = {1988},
    title = {Term-weighting approaches in automatic text retrieval},
    journal = {Information processing \& management},
    volume = {24},
    number = {5},
    pages = {513--523},
}

@book{ref227,
    author = {杨金鼎},
    title = {中国文化史词典},
    publisher = {中国文化史词典},
    year = {1987},
}

@book{ref228,
    author = {Strayer, J},
    title = {Empathy and Its Development},
    publisher = {New York, NY: Cambridge University Press},
    year = {1987},
    series = {Affective and Cognitive Perspectives on Empathy},
}

@book{ref229,
    author = {Valdes, Joyce Merrill and others},
    title = {Culture bound: Bridging the culture gap in language teaching},
    publisher = {Cambridge: Cambridge University Press},
    year = {1986},
    volume = {25},
}

@article{ref230,
    author = {Schumann, John H},
    year = {1986},
    title = {Research on the acculturation model for second language acquisition},
    journal = {Journal of multilingual \& multicultural development},
    volume = {7},
    number = {5},
    pages = {379--392},
}

@article{ref231,
    author = {Oddou, Mendenhall Gary},
    year = {1985},
    title = {The Dimensions of Expatriate Acculturation: A Review},
    journal = {The Academy of Management Review},
    volume = {10},
    number = {1},
    pages = {39-47},
}

@book{ref232,
    author = {Schon, Donald A},
    title = {The reflective practitioner: How professionals think in action},
    publisher = {Basic books},
    year = {1984},
    volume = {5126},
}

@book{ref233,
    author = {Caplan, R. D},
    title = {Stress research: Issues for the eighties},
    publisher = {Chichester, UK: Wiley},
    year = {1983},
    series = {Person-environment fi t: Past,present, and future},
}

@article{ref234,
    author = {Church, Austin T},
    year = {1982},
    title = {Sojourner adjustment},
    journal = {Psychological bulletin},
    volume = {91},
    number = {3},
    pages = {540},
}

@article{ref235,
    author = {Davis, Mark H},
    year = {1980},
    title = {A multidimensional approach to individual differences in empathy},
    journal = {},
}

@book{ref236,
    author = {Schneider, David M and Schneider, David Murray},
    title = {American kinship: A cultural account},
    publisher = {University of Chicago Press},
    year = {1980},
}

@article{ref237,
    author = {Rozin, Paul},
    year = {1980},
    title = {Human food selection: why do we know so little, and what can we do about it},
    journal = {International journal of obesity},
    volume = {4},
    number = {4},
    pages = {333--337},
}

@article{ref238,
    author = {Iso-Ahola, Seppo E},
    year = {1980},
    title = {The social psychology of leisure and recreation},
    journal = {},
}

@article{ref239,
    author = {Pruitt, France J},
    year = {1978},
    title = {The adaptation of African students to American society},
    journal = {International Journal of Intercultural Relations},
    volume = {2},
    number = {1},
    pages = {90--118},
}

@article{ref240,
    author = {Berger, C. R.  and  Calabrese, R. J},
    year = {1975},
    title = {SOME EXPLORATIONS IN INITIAL INTERACTION AND BEYOND: TOWARD A DEVELOPMENTAL THEORY OF INTERPERSONAL COMMUNICATION},
    journal = {Human Communication Research},
    volume = {1},
    number = {2},
}

@book{ref241,
    author = {Geertz, Clifford},
    title = {The interpretation of cultures},
    publisher = {Basic books},
    year = {1973},
    volume = {5043},
}

@article{ref242,
    author = {Salton, Gerard and Yu, Clement T},
    year = {1973},
    title = {On the construction of effective vocabularies for information retrieval},
    journal = {Acm Sigplan Notices},
    volume = {10},
    number = {1},
    pages = {48--60},
}

@article{ref243,
    author = {Jones, Karen Sparck},
    year = {1973},
    title = {Index term weighting},
    journal = {Information storage and retrieval},
    volume = {9},
    number = {11},
    pages = {619--633},
}

@article{ref244,
    author = {Kang, Tai Shick},
    year = {1972},
    title = {A foreign student group as an ethnic community},
    journal = {International Review of Modern Sociology},
    pages = {72--82},
}

@article{ref245,
    author = {GLASER, B and STRAUSS, A},
    year = {1967},
    title = {The Discovery of Grounded Theory (Chicago IL Aladine},
    journal = {},
}

@article{ref246,
    author = {Major Jr, Randolph T},
    year = {1965},
    title = {A review of research on international exchange},
    journal = {Unpublished manuscript. The Experiment on International Living, Putney, VT},
}

@book{ref247,
    author = {Gordon, Milton M},
    title = {Assimilation in American life: The role of race, religion, and national origins},
    publisher = {Oxford University Press, USA},
    year = {1964},
}

@article{ref248,
    author = {McClintock, Charles G and Davis, James},
    year = {1958},
    title = {Changes in the Attribute of “Nationality” in the Self-Percept of the “Stranger},
    journal = {The Journal of Social Psychology},
    volume = {48},
    number = {2},
    pages = {183--193},
}

@book{ref249,
    author = {Dewey, John},
    title = {Democracy and education: An introduction to the philosophy of education},
    publisher = {Macmillan New York},
    year = {出版中},
}
@book{ref249,
    author = {Dewey, John},
    title = {Democracy and education: An introduction to the philosophy of education},
    publisher = {Macmillan New York},
    year = {1930},
}@book{ref249,
    author = {Dewey, John},
    title = {Democracy and education: An introduction to the philosophy of education},
    publisher = {Macmillan New York},
    year = {1930},
}@book{ref249,
    author = {Dewey, John},
    title = {Democracy and education: An introduction to the philosophy of education},
    publisher = {Macmillan New York},
    year = {1930},
}@book{ref249,
    author = {Dewey, John},
    title = {Democracy and education: An introduction to the philosophy of education},
    publisher = {Macmillan New York},
    year = {1930},
}@book{ref249,
    author = {Dewey, John},
    title = {Democracy and education: An introduction to the philosophy of education},
    publisher = {Macmillan New York},
    year = {1930},
}

`


let a = new read_bib(bibtxt)
a.recitekey = 1
// a.sortby = 'year'
let bib = a.to_bib
let bbl = a.to_bbl



import fs from 'fs';

let filename = "bib.txt";
fs.writeFile(filename, bib, function (err) {
    if (err) throw err;
    console.log('File saved!');
});